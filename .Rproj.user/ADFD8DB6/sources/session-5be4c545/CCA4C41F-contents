---
title: "Gráficos Relatório Monitora"
subtitle: Componente Florestal
author: "Arlindo Gomes Filho" # Autoria
lang: pt # Linguagem em português
date: "`r format(Sys.Date())`" # Data do relatório
date-format: short # Formato de data curto: dd/MM/yyyy 
toc: true # Adiciona um índice no relatório
format: 
    html: 
      #code-fold: true # code-fold: true para "ocultar" o bloco de códigos
      #code-tools: true  #code-tools: true para ativar ferramentas de interação com os códigos
      theme: 
        light: cosmo
        dark: superhero # Sugestão: superhero/vapor - Mudar o tema do relatório aqui
title-block-banner: "#BAEBEB" # Pode ser 'true', uma cor ou imagem
code-annotations: hover # Para anotações em códigos
execute:
  echo: false
  warning: false
  message: false
  freeze: true
---

```{r pacotes, echo = FALSE}

# Carregando os pacotes

if(!require(pacman)){install.packages("pacman")}
pacman::p_load(tidyverse, 
               httr,
               lubridate,
               janitor, 
               DT, 
               plotly,
               viridis,
               cols4all,
               ggExtra,
               ggpubr,
               leaflet,
               sf,
               tibble, 
               rgdal,
               sp,
               htmltools,
               htmlwidgets,
               janitor,
               tmap
               )

```

```{r processamento dos dados, inclue = FALSE}

# Carregando os dados

masto_aves <-
  read_csv2("dados_brutos/base_masto_aves_esforco_corrigido.csv")

ucs_grupos <-
  read_csv2("dados_brutos/ucs_grupos.csv")


# Juntando planilha masto_aves com planilha ucs_grupos

masto_aves <-
  left_join(masto_aves, ucs_grupos, by = "cnuc")

#View(masto_aves)

# Criando a coluna biomas

masto_aves <- masto_aves %>% 
mutate(
  bioma = case_when(
    uc == "Esec de Pirapitinga" ~ "Cerrado",
    uc == "Esec Serra Geral do Tocantins" ~ "Cerrado",
    uc == "Parna da Chapada dos Veadeiros" ~ "Cerrado",
    uc == "Parna da Serra da Bodoquena" ~ "Cerrado",
    uc == "Parna da Serra do Cipó" ~ "Cerrado",
    uc == "Parna da Serra da Bocaina" ~ "Mata Atlântica",
    uc == "Parna da Serra dos Órgãos" ~ "Mata Atlântica",
    uc == "Parna do Iguaçu" ~ "Mata Atlântica",
    uc == "Parna do Superagui" ~ "Mata Atlântica",
    uc == "Rebio Guaribas" ~ "Mata Atlântica",
    uc == "Rebio de Una" ~ "Mata Atlântica",
    TRUE ~ "Amazônia"))

#View(masto_aves)

#unique(masto_aves$bioma)

# Corrigindo a lista de primatas - alterando registros na coluna "taxon_validado" 
# de Mico spp para Mico sp e "Callicebus spp" para "Callicebus sp"

masto_aves <- masto_aves %>% 
mutate(
  taxon_validado = case_when(
    taxon_validado == "Mico spp" ~ "Mico sp",
    taxon_validado == "Callicebus spp" ~ "Callicebus sp",
    TRUE ~ taxon_validado))

# list_primatas <- masto_aves |> 
#   filter(ordem == "Primates") 

#unique(list_primatas$taxon_validado)

masto_aves$uc <- as.factor(masto_aves$uc)
masto_aves$bioma <- as.factor(masto_aves$bioma)
masto_aves$uc_ca <- as.factor(masto_aves$uc_ca)
masto_aves$categoria <- as.factor(masto_aves$categoria)
masto_aves$grupo <- as.factor(masto_aves$grupo)

#glimpse(masto_aves)

```

```{r paletas de cores, echo = FALSE}

# Criando paletas de cores

# cores = viridis(13)
# cores <- brewer.pal(12, "Set3")
# cores <- colorRampPalette(c("darkblue","lightblue"))
# cores(13)

cor1 <- c(Primates = "#008B8B",
      Rodentia = "#4AB1B1",
      Tinamiformes = "#70C4C4",
      Galliformes = "#95D8D8",
      Artiodactyla = "#CDF5F5",
      Gruiformes = "#D9D9D9",
      Carnivora = "#CCCCCC",
      Pilosa = "#B2B2B2",
      Perissodactyla = "#999999",
      Cingulata = "#666666",
      Didelphimorphia = "#FEE6CE",
      Lagomorpha = "#FDAE6B",
      Cariamiformes = "#E6550D")


cor2 <- c("#008B8B",
          "#CDF5F5",
          "#D9D9D9",
          "#70C4C4",
          "#666666"
          )

cor3 <-
  c(
    "#008B8B",
    "#129494",
    "#008B8B",
    "#38A8A8",
    "#4AB1B1",
    "#5DBBBB",
    "#70C4C4",
    "#82CECE",
    "#95D8D8",
    "#A8E2E2",
    "#BAEBEB",
    "#CDF5F5",
    "#E0FFFF"
    )


cor4 <- c("#008B8B", "#BAEBEB", "#259E9E", "#E0FFFF", "#38A8A8", "#95D8D8")

```

# Gráficos registros por ordem

## Gráfico de rosca completo - todas as categorias

```{r G_porcentagem_registros_ordem_completo, echo = FALSE}

# Gráfico de rosca completo - todas as categorias"

G_porcentagem_registros_ordem_completo <- masto_aves %>%
  filter(!is.na(ordem)) %>%
  group_by(ordem) %>%
  summarise(count = n()) %>%
  plot_ly(
    labels = ~ ordem,
    values = ~ count,
    marker = list(colors = cor3)
  ) %>%
  add_pie(hole = 0.4)

G_porcentagem_registros_ordem_completo

ggsave("graficos/G_porcentagem_registros_ordem_completo.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

## Gráfico de rosca incompleto - com a categoria "Outros"

```{r preparando_dados_grafico_rosca_incompleto, include = FALSE}


# Agrupando ordens e criando uma planilha com a categoria "Outros"


masto_aves1 <- masto_aves |>
  mutate(ordem = fct_infreq(ordem))

fct_lump_n(masto_aves1$ordem, n = 4, other_level = "Outros")

masto_aves1 <- masto_aves |>
  mutate(ordem_lumped = fct_lump_n(masto_aves1$ordem,
                                   n = 4,
                                   other_level = "Outros"))

#unique(masto_aves1$ordem_lumped)

```

```{r G_porcentagem_registros_ordem_agrupado, echo = FALSE}


G_porcentagem_registros_ordem_agrupado <- masto_aves1 %>%
  filter(!is.na(ordem_lumped)) %>%
  group_by(ordem_lumped) %>%
  summarise(count = n()) %>%
  plot_ly(
    labels = ~ ordem_lumped,
    values = ~ count,
    marker = list(colors = cor2)
  ) %>%
  add_pie(hole = 0.4)

G_porcentagem_registros_ordem_agrupado

ggsave("graficos/G_porcentagem_registros_ordem_agrupado.png", height = 4.5, width = 6, units = "in", dpi = 300)


```

## Gráfico de registros por ordem - barras - escala logaritmica

```{r G_registros_ordem_barras_escala_logaritmica, echo = FALSE}


# Gráfico de registros por ordem - barras - escala logarítmica


G_registros_ordem_barras_escala_logaritmica <- masto_aves %>%
  filter(!is.na(ordem)) %>%
  group_by(ordem) %>%
  summarise(count = n()) %>%
  
  ggplot(aes(x = fct_reorder(ordem, count, .desc = F), y = count)) +
  geom_col(aes(fill = ordem)) +
  scale_fill_manual(
    values = c(
      Primates = "#008B8B",
      Rodentia = "#129494",
      Tinamiformes = "#259E9E",
      Galliformes = "#38A8A8",
      Artiodactyla = "#4AB1B1",
      Gruiformes = "#5DBBBB",
      Carnivora = "#70C4C4",
      Pilosa = "#82CECE",
      Perissodactyla = "#95D8D8",
      Cingulata = "#A8E2E2",
      Didelphimorphia = "#BAEBEB",
      Lagomorpha = "#CDF5F5",
      Cariamiformes = "#E0FFFF"
      )
  ) +
  coord_flip() +
  scale_x_discrete(name = " ") +
  #scale_y_continuous(name = " ") +
  scale_y_log10(name = "Número de registros", labels = scales::number_format(big.mark = ".")
    ) +
  theme_minimal() +
  theme(
    panel.grid.minor.y = element_blank(),
    panel.grid.major.y = element_blank(),
    panel.grid.minor.x = element_blank(),
    #panel.grid.major.x = element_blank(),
    legend.position = "none",
    axis.title.x = element_text(size = 11, margin = margin(t = 10))
  ) +
  labs(title = "Distribuição dos registros por ordem",
       y = "Número de registros")

G_registros_ordem_barras_escala_logaritmica

ggsave("graficos/G_registros_ordem_barras_escala_logaritimica.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

## Gráfico de registros por ordem - barras - escala normal

```{r G_registros_ordem_barras_escala_normal, echo = FALSE}

# Gráfico de registros por ordem - barras - escala normal

G_registros_ordem_barras_escala_normal <-  masto_aves %>%
  filter(!is.na(ordem)) %>%
  group_by(ordem) %>%
  summarise(count = n()) %>%
  
  ggplot(aes(x = fct_reorder(ordem, count, .desc = F), y = count)) +
  geom_col(aes(fill = ordem)) +
  scale_fill_manual(
    values = c(
      Primates = "#008B8B",
      Rodentia = "#129494",
      Tinamiformes = "#259E9E",
      Galliformes = "#38A8A8",
      Artiodactyla = "#4AB1B1",
      Gruiformes = "#5DBBBB",
      Carnivora = "#70C4C4",
      Pilosa = "#82CECE",
      Perissodactyla = "#95D8D8",
      Cingulata = "#A8E2E2",
      Didelphimorphia = "#BAEBEB",
      Lagomorpha = "#CDF5F5",
      Cariamiformes = "#E0FFFF"
    )
  ) +
  coord_flip() +
  scale_x_discrete(name = "") +
  #scale_y_log10(name = " ") +
  theme_minimal() +
  theme(
    panel.grid.minor.y = element_blank(),
    panel.grid.major.y = element_blank(),
    panel.grid.minor.x = element_blank(),
    #panel.grid.major.x = element_blank(),
    legend.position = "none",
    axis.title.x = element_text(size = 11, margin = margin(t = 10))
  ) +
  scale_y_continuous(breaks = seq(0, 12000, by = 1000), name = "Número de registros",
                     expand = expansion(add = c(0, 1000)),
                     labels = scales::number_format(#accuracy = 0,
                                                       decimal.mark = ",",
                                                       big.mark = ".")) +
  labs(title = "Distribuição dos registros por ordem",
       y = "Número de registros")

G_registros_ordem_barras_escala_normal

ggsave("graficos/G_registros_ordem_barras_escala_normal.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

## Gráfico de registros por ordem - barras - Amazônia

```{r G_registros_ordem_amazonia, echo = FALSE}


# Gráfico registros por ordem - Amazônia


G_registros_ordem_amazonia <-  masto_aves %>%
  filter(bioma == "Amazônia") |> 
  filter(!is.na(ordem)) %>%
  group_by(ordem) %>%
  summarise(count = n()) %>%
  
  ggplot(aes(x = fct_reorder(ordem, count, .desc = F), y = count)) +
  geom_col(aes(fill = ordem)) +
  scale_fill_manual(
    values = c(
      Primates = "#008B8B",
      Rodentia = "#129494",
      Tinamiformes = "#259E9E",
      Galliformes = "#38A8A8",
      Artiodactyla = "#4AB1B1",
      Gruiformes = "#5DBBBB",
      Carnivora = "#70C4C4",
      Pilosa = "#82CECE",
      Perissodactyla = "#95D8D8",
      Cingulata = "#A8E2E2",
      Didelphimorphia = "#BAEBEB",
      Lagomorpha = "#CDF5F5",
      Cariamiformes = "#E0FFFF"
    )
  ) +
  coord_flip() +
  scale_x_discrete(name = "") +
  #scale_y_log10(name = " ") +
  theme_minimal() +
  theme(
    panel.grid.minor.y = element_blank(),
    panel.grid.major.y = element_blank(),
    panel.grid.minor.x = element_blank(),
    #panel.grid.major.x = element_blank(),
    legend.position = "none",
    axis.title.x = element_text(size = 11, margin = margin(t = 10))
  ) +
  scale_y_continuous(breaks = seq(0, 12000, by = 1000), name = "Número de registros",
                     expand = expansion(add = c(0, 1000)),
                     labels = scales::number_format(#accuracy = 0,
                                                       decimal.mark = ",",
                                                       big.mark = ".")) +
  labs(title = "Distribuição dos registros por ordem - Amazônia",
       y = "Número de registros")

G_registros_ordem_amazonia

ggsave("graficos/G_registros_ordem_amazonia.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

## Gráfico de registros por ordem - barras - Mata Atlântica

```{r G_registros_ordem_mata_atlantica, echo = FALSE}

# Gráfico de registros por ordem - Mata Atlântica

G_registros_ordem_mata_atlantica <-  masto_aves %>%
  filter(bioma == "Mata Atlântica") |> 
  filter(!is.na(ordem)) %>%
  group_by(ordem) %>%
  summarise(count = n()) %>%
  
  ggplot(aes(x = fct_reorder(ordem, count, .desc = F), y = count)) +
  geom_col(aes(fill = ordem)) +
  scale_fill_manual(
    values = c(
      Primates = "#008B8B",
      Rodentia = "#129494",
      Tinamiformes = "#259E9E",
      Galliformes = "#38A8A8",
      Artiodactyla = "#4AB1B1",
      Gruiformes = "#5DBBBB",
      Carnivora = "#70C4C4",
      Pilosa = "#82CECE",
      Perissodactyla = "#95D8D8",
      Cingulata = "#A8E2E2",
      Didelphimorphia = "#BAEBEB",
      Lagomorpha = "#CDF5F5",
      Cariamiformes = "#E0FFFF"
    )
  ) +
  coord_flip() +
  scale_x_discrete(name = "") +
  #scale_y_log10(name = " ") +
  theme_minimal() +
  theme(
    panel.grid.minor.y = element_blank(),
    panel.grid.major.y = element_blank(),
    panel.grid.minor.x = element_blank(),
    #panel.grid.major.x = element_blank(),
    legend.position = "none",
    axis.title.x = element_text(size = 11, margin = margin(t = 10))
  ) +
  scale_y_continuous(#breaks = seq(0, 12000, by = 1000), name = "Número de registros",
                     #expand = expansion(add = c(0, 1000)),
                     labels = scales::number_format(#accuracy = 0,
                                                       decimal.mark = ",",
                                                       big.mark = ".")) +
  labs(title = "Distribuição dos registros por ordem - Mata Atlântica",
       y = "Número de registros")

G_registros_ordem_mata_atlantica

ggsave("graficos/G_registros_ordem_mata_atlantica.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

## Gráfico de registros por ordem - barras - Cerrado

```{r G_registros_ordem_cerrado, echo = FALSE}

# Gráfico de registros por ordem - Cerrado

G_registros_ordem_cerrado <-  masto_aves %>%
  filter(bioma == "Cerrado") |> 
  filter(!is.na(ordem)) %>%
  group_by(ordem) %>%
  summarise(count = n()) %>%
  
  ggplot(aes(x = fct_reorder(ordem, count, .desc = F), y = count)) +
  geom_col(aes(fill = ordem)) +
  scale_fill_manual(
    values = c(
      Primates = "#008B8B",
      Rodentia = "#129494",
      Tinamiformes = "#259E9E",
      Galliformes = "#38A8A8",
      Artiodactyla = "#4AB1B1",
      Gruiformes = "#5DBBBB",
      Carnivora = "#70C4C4",
      Pilosa = "#82CECE",
      Perissodactyla = "#95D8D8",
      Cingulata = "#A8E2E2",
      Didelphimorphia = "#BAEBEB",
      Lagomorpha = "#CDF5F5",
      Cariamiformes = "#E0FFFF"
    )
  ) +
  coord_flip() +
  scale_x_discrete(name = "") +
  #scale_y_log10(name = " ") +
  theme_minimal() +
  theme(
    panel.grid.minor.y = element_blank(),
    panel.grid.major.y = element_blank(),
    panel.grid.minor.x = element_blank(),
    #panel.grid.major.x = element_blank(),
    legend.position = "none",
    axis.title.x = element_text(size = 11, margin = margin(t = 10))
  ) +
  scale_y_continuous(#breaks = seq(0, 12000, by = 1000), name = "Número de registros",
                     #expand = expansion(add = c(0, 1000)),
                     labels = scales::number_format(#accuracy = 0,
                                                       decimal.mark = ",",
                                                       big.mark = ".")) +
  labs(title = "Distribuição dos registros por ordem - Cerrado",
       y = "Número de registros")

G_registros_ordem_cerrado

ggsave("graficos/G_registros_ordem_cerrado.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

```{r contagem_especies_por_ordem, echo = FALSE}

# Limpando dados da coluna taxon-validado para a contagem de número de 
# espécies por ordem
# Foram excluídos alguns regitros "gênero sp", para os casos em que todas # as espécies do gênero já tenham sido registradas


limpeza_registros_numero_especies_por_ordem <-  masto_aves %>%
  filter(!(masto_aves$taxon_validado  == "Aburria sp" |
             masto_aves$taxon_validado  == "Crax sp" |
             masto_aves$taxon_validado  == "Odonthophorus sp" |
             masto_aves$taxon_validado  == "Pauxi sp" |
             masto_aves$taxon_validado  == "Coendou sp" |
             masto_aves$taxon_validado  == "Myoprocta sp" |
             masto_aves$taxon_validado  == "Dasyprocta sp" |
             masto_aves$taxon_validado  == "Microsciurus sp" |
             masto_aves$taxon_validado  == "Sciurillus sp" |
             masto_aves$taxon_validado  == "Urosciurus sp" |
             masto_aves$taxon_validado  == "Guerlinguetus sp" |
             masto_aves$taxon_validado  == "Mazama sp" |
             masto_aves$taxon_validado  == "Leopardus sp" |
             masto_aves$taxon_validado  == "Cacajao sp" |
             masto_aves$taxon_validado  == "Callicebus sp" |
             masto_aves$taxon_validado  == "Callithrix sp" |
             masto_aves$taxon_validado  == "Cebus sp" |
             masto_aves$taxon_validado  == "Saimiri sp" 
             )) |> 
  filter(!is.na(ordem)) %>%
  filter(!is.na(taxon_validado)) |> 
  group_by(taxon_validado, ordem) %>%
  summarise(count = n()) 

#limpeza_registros_numero_especies_por_ordem
 

contagem_numero_especies_por_ordem <- limpeza_registros_numero_especies_por_ordem |> 
  group_by(ordem) |> 
  count() |> 
  arrange(desc(n))

#contagem_numero_especies_por_ordem

# unique(G1.6$taxon_validado)
# 
# G1.7 <- G1.5 |> 
#   group_by(taxon_validado) |> 
#   count()
# 
# G1.7
```

## Gráfico do número de espécies por ordem - barras - geral

```{r G_numero_especies_ordem_geral, echo = FALSE}

# Gráfico do número de espécies por ordem - geral


G_numero_especies_ordem_geral <- contagem_numero_especies_por_ordem  |> 
  ggplot(aes(x = fct_reorder(ordem, n, .desc = F), y = n)) +
  geom_col(aes(fill = ordem)) +
  scale_fill_manual(
    values = c(
      Primates = "#008B8B",
      Rodentia = "#129494",
      Tinamiformes = "#259E9E",
      Galliformes = "#38A8A8",
      Artiodactyla = "#4AB1B1",
      Gruiformes = "#5DBBBB",
      Carnivora = "#70C4C4",
      Pilosa = "#82CECE",
      Perissodactyla = "#95D8D8",
      Cingulata = "#A8E2E2",
      Didelphimorphia = "#BAEBEB",
      Lagomorpha = "#CDF5F5",
      Cariamiformes = "#E0FFFF"
    )
  ) +
  coord_flip() +
  scale_x_discrete(name = "") +
  #scale_y_log10(name = " ") +
  theme_minimal() +
  theme(
    panel.grid.minor.y = element_blank(),
    panel.grid.major.y = element_blank(),
    panel.grid.minor.x = element_blank(),
    #panel.grid.major.x = element_blank(),
    legend.position = "none",
    axis.title.x = element_text(size = 11, margin = margin(t = 10))
  ) +
  scale_y_continuous(breaks = seq(0, 100, by = 10), name = "Número de espécies",
                     expand = expansion(add = c(0, 10)),
                     labels = scales::number_format(#accuracy = 0,
                                                       decimal.mark = ",",
                                                       big.mark = ".")) +
  labs(title = "Número de espécies por ordem",
       y = "Número de espécies")

G_numero_especies_ordem_geral

ggsave("graficos/G_especies_ordem_geral.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

```{r limpeza_registros_numero_especies_por_ordem_bioma, include = FALSE}

# Limpeza dos registros das espécies 

limpeza_registros_numero_especies_por_ordem_bioma <-  masto_aves %>%
  filter(!(masto_aves$taxon_validado  == "Aburria sp" |
             masto_aves$taxon_validado  == "Crax sp" |
             masto_aves$taxon_validado  == "Odonthophorus sp" |
             masto_aves$taxon_validado  == "Pauxi sp" |
             masto_aves$taxon_validado  == "Coendou sp" |
             masto_aves$taxon_validado  == "Myoprocta sp" |
             masto_aves$taxon_validado  == "Dasyprocta sp" |
             masto_aves$taxon_validado  == "Microsciurus sp" |
             masto_aves$taxon_validado  == "Sciurillus sp" |
             masto_aves$taxon_validado  == "Urosciurus sp" |
             masto_aves$taxon_validado  == "Guerlinguetus sp" |
             masto_aves$taxon_validado  == "Mazama sp" |
             masto_aves$taxon_validado  == "Leopardus sp" |
             masto_aves$taxon_validado  == "Cacajao sp" |
             masto_aves$taxon_validado  == "Callicebus sp" |
             masto_aves$taxon_validado  == "Callithrix sp" |
             masto_aves$taxon_validado  == "Cebus sp" |
             masto_aves$taxon_validado  == "Saimiri sp" 
             )) |> 
  filter(!is.na(ordem)) %>%
  filter(!is.na(taxon_validado)) |> 
  group_by(taxon_validado, ordem, bioma) %>%
  summarise(count = n()) 

#limpeza_registros_numero_especies_por_ordem_bioma

contagem_numero_especies_por_ordem_bioma <- limpeza_registros_numero_especies_por_ordem_bioma |> 
  group_by(bioma, ordem) |> 
  count() |> 
  arrange(desc(n))

#contagem_numero_especies_por_ordem_bioma

```

## Gráfico do número de espécies por ordem - barras - Amazônia

```{r G_especies_ordem_amazonia, echo = FALSE}

# Gráfico do número de espécies por ordem - Amazônia

G_especies_ordem_amazonia <- contagem_numero_especies_por_ordem_bioma  |>
  filter(bioma == "Amazônia") |> 
  
  ggplot(aes(x = fct_reorder(ordem, n, .desc = F), y = n)) +
  geom_col(aes(fill = ordem)) +
  scale_fill_manual(
    values = c(
      Primates = "#008B8B",
      Rodentia = "#129494",
      Tinamiformes = "#259E9E",
      Galliformes = "#38A8A8",
      Artiodactyla = "#4AB1B1",
      Gruiformes = "#5DBBBB",
      Carnivora = "#70C4C4",
      Pilosa = "#82CECE",
      Perissodactyla = "#95D8D8",
      Cingulata = "#A8E2E2",
      Didelphimorphia = "#BAEBEB",
      Lagomorpha = "#CDF5F5",
      Cariamiformes = "#E0FFFF"
    )
  ) +
  coord_flip() +
  scale_x_discrete(name = "") +
  #scale_y_log10(name = " ") +
  theme_minimal() +
  theme(
    panel.grid.minor.y = element_blank(),
    panel.grid.major.y = element_blank(),
    panel.grid.minor.x = element_blank(),
    #panel.grid.major.x = element_blank(),
    legend.position = "none",
    axis.title.x = element_text(size = 11, margin = margin(t = 10))
  ) +
  scale_y_continuous(breaks = seq(0, 100, by = 10), name = "Número de espécies",
                     expand = expansion(add = c(0, 10)),
                     labels = scales::number_format(#accuracy = 0,
                                                       decimal.mark = ",",
                                                       big.mark = ".")) +
  labs(title = "Número de espécies por ordem - Amazônia",
       y = "Número de espécies")

G_especies_ordem_amazonia

ggsave("graficos/G_especies_ordem_amazonia.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

## Gráfico do número de espécies por ordem - barras - Mata Atlântica

```{r G_especies_ordem_mata_atlantica, echo = FALSE}

# Gráfico do número de espécies por ordem - Mata Atlântica

G_especies_ordem_mata_atlantica <- contagem_numero_especies_por_ordem_bioma  |>
  filter(bioma == "Mata Atlântica") |> 
  
  ggplot(aes(x = fct_reorder(ordem, n, .desc = F), y = n)) +
  geom_col(aes(fill = ordem)) +
  scale_fill_manual(
    values = c(
      Primates = "#008B8B",
      Rodentia = "#129494",
      Tinamiformes = "#259E9E",
      Galliformes = "#38A8A8",
      Artiodactyla = "#4AB1B1",
      Gruiformes = "#5DBBBB",
      Carnivora = "#70C4C4",
      Pilosa = "#82CECE",
      Perissodactyla = "#95D8D8",
      Cingulata = "#A8E2E2",
      Didelphimorphia = "#BAEBEB",
      Lagomorpha = "#CDF5F5",
      Cariamiformes = "#E0FFFF"
    )
  ) +
  coord_flip() +
  scale_x_discrete(name = "") +
  #scale_y_log10(name = " ") +
  theme_minimal() +
  theme(
    panel.grid.minor.y = element_blank(),
    panel.grid.major.y = element_blank(),
    panel.grid.minor.x = element_blank(),
    #panel.grid.major.x = element_blank(),
    legend.position = "none",
    axis.title.x = element_text(size = 11, margin = margin(t = 10))
  ) +
  scale_y_continuous(breaks = seq(0, 10, by = 2), name = "Número de espécies",
                     expand = expansion(add = c(0, 2)),
                     labels = scales::number_format(#accuracy = 0,
                                                       decimal.mark = ",",
                                                       big.mark = ".")) +
  labs(title = "Número de espécies por ordem - Mata Atlântica",
       y = "Número de espécies")

G_especies_ordem_mata_atlantica

ggsave("graficos/G_especies_ordem_mata_atlantica.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

## Gráfico do número de espécies por ordem - barras - Cerrado

```{r G_especies_ordem_cerrado, echo = FALSE}

# Gráfico do número de espécies por ordem - Cerrado

G_especies_ordem_cerrado <- contagem_numero_especies_por_ordem_bioma  |>
  filter(bioma == "Cerrado") |> 
  
  ggplot(aes(x = fct_reorder(ordem, n, .desc = F), y = n)) +
  geom_col(aes(fill = ordem)) +
  scale_fill_manual(
    values = c(
      Primates = "#008B8B",
      Rodentia = "#129494",
      Tinamiformes = "#259E9E",
      Galliformes = "#38A8A8",
      Artiodactyla = "#4AB1B1",
      Gruiformes = "#5DBBBB",
      Carnivora = "#70C4C4",
      Pilosa = "#82CECE",
      Perissodactyla = "#95D8D8",
      Cingulata = "#A8E2E2",
      Didelphimorphia = "#BAEBEB",
      Lagomorpha = "#CDF5F5",
      Cariamiformes = "#E0FFFF"
    )
  ) +
  coord_flip() +
  scale_x_discrete(name = "") +
  #scale_y_log10(name = " ") +
  theme_minimal() +
  theme(
    panel.grid.minor.y = element_blank(),
    panel.grid.major.y = element_blank(),
    panel.grid.minor.x = element_blank(),
    #panel.grid.major.x = element_blank(),
    legend.position = "none",
    axis.title.x = element_text(size = 11, margin = margin(t = 10))
  ) +
  scale_y_continuous(breaks = seq(0, 5, by = 1), name = "Número de espécies",
                     expand = expansion(add = c(0, 2)),
                     labels = scales::number_format(#accuracy = 0,
                                                       decimal.mark = ",",
                                                       big.mark = ".")) +
  labs(title = "Número de espécies por ordem - Cerrado",
       y = "Número de espécies")

G_especies_ordem_cerrado

ggsave("graficos/G_especies_ordem_cerrado.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

## Gráfico do número de espécies e de registros por ordem - barras - geral

```{r G_especies_registros_ordem_geral, echo = FALSE}

# Gráfico do número de espécies e de regsitros por ordem - geral

contagem_numero_especies_por_ordem <- limpeza_registros_numero_especies_por_ordem |> 
  group_by(ordem) |> 
  count() |> 
  arrange(desc(n))

contagem_numero_especies_por_ordem

registros <- masto_aves %>%
  filter(!is.na(ordem)) |> 
  group_by(ordem) %>%
  summarise(count = n()) |> 
  arrange(desc(count))

# contagem_numero_especies_por_ordem$ordem =
#   factor(c("Primates",
#            "Rodentia",
#            "Galliformes",
#            "Carnivora",
#            "Gruiformes",
#            "Pilosa",
#            "Artiodactyla",
#            "Tinamiformes",
#            "Cingulata",
#            "Didelphimorphia",
#            "Cariamiformes",
#            "Lagomorpha",
#            "Perissodactyla"),
#   levels = c("Primates",
#              "Rodentia",
#              "Tinamiformes",
#              "Galliformes",
#              "Artiodactyla",
#              "Gruiformes",
#              "Carnivora",
#              "Pilosa",
#              "Perissodactyla",
#              "Cingulata",
#              "Didelphimorphia",
#              "Lagomorpha",
#              "Cariamiformes"))

G_especies_registros_ordem_geral <- contagem_numero_especies_por_ordem  |> 
  
  ggplot() +
  # geom_col(data = registros, aes(x = fct_reorder(ordem, n, .desc = F), y = n, fill = "darkgreen")) +
  geom_col(aes(x = fct_reorder(ordem, n, .desc = F), y = n, fill = "darkcyan")) +
  geom_label(aes(ordem, n, label = n, alpha = 0.5, hjust = -0.1)) +
  geom_col(data = registros, aes(x = ordem, y = count), fill = "darkgreen") +
  geom_text(aes(ordem, n, label = n, alpha = 0.5, hjust = -20)) +
  
  # geom_col(aes(x = fct_reorder(ordem, n, .desc = F), y = n, fill = "darkcyan")) +
  # geom_label(aes(ordem, n, label = n, alpha = 0.5, hjust = -0.1)) +
  coord_flip() +
  scale_fill_manual(
    values = c("darkcyan","#A8E2E2")) +
  scale_x_discrete(name = "") +
  theme_minimal() +
  theme(
    panel.grid.minor.y = element_blank(),
    panel.grid.major.y = element_blank(),
    panel.grid.minor.x = element_blank(),
    panel.grid.major.x = element_blank(),
    axis.line.y=element_blank(),
    axis.text=element_blank(),
    legend.position = "none",
    axis.title.x = element_text(size = 11, margin = margin(t = 10))
  ) +
  scale_y_log10(name = "", labels = scales::number_format(big.mark = ".")) +
  labs(title = " ",
       y = "Número de espécies e de registros por ordem")

G_especies_registros_ordem_geral

ggsave("graficos/G_especies_registros_ordem_geral.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

# Gráficos das taxas de encontro

```{r estimativas_taxas_de_encontro, include = FALSE}


# Cálculo das taxas de encontro - ajustando os dados

# Checando os nomes das colunas

#names(masto_aves) 

# Preenchendo as linhas vazias da coluna esforço

masto_aves_esforco <-
  masto_aves |> 
  arrange(uc, ano, ea) |>
  fill(esforco)

# visualizando a nova planilha com a coluna de esforço preenchida

# View(masto_aves_esforco) 


# Limpando a planilha - selecionando apenas colunas relevantes

masto_aves_esforco <- masto_aves_esforco |>
  select(
    cnuc,
    uc,
    bioma,
    ano,
    ea,
    everything(),
    -c(
      h_fim,
      cond_clim,
      populacao,
      tempo_censo,
      observadores,
      problema_amostragem,
      nome_ea,
      h_inicio,
      velocidade,
      n_guia,
      h_avistamento,
      observacoes
    )
   )

# Col_NAs <- select(masto_aves_esforco, where(anyNA)) # selecionando as colunas com NAs
# Col_NAs
#
# View(masto_aves_esforco)
#
# Col_NAs <- select(masto_aves_esforco, where(anyNA)) |> # selecionando nomes das colunas com NAs

#   names()
# Col_NAs

#glimpse(masto_aves_esforco)

```

```{r calculando_esforço_por_trilha, include = FALSE}


### Calculando o esforço por trilha (ea)


# Visualizando o esforço por trilha por dia em cada ano e UC

#unique(masto_aves_esforco$esforco) # Valores únicos de esforço

esforco_dia_trilha <- masto_aves_esforco  |> # extensão percorrida por dia
  
  distinct(uc, bioma, grupo, ano, ea, data, esforco) 
  
#View(esforco_dia_trilha)


esforco_dia_trilha_rep <- masto_aves_esforco  |> # número amostragens por trilha
  
  distinct(uc, bioma, grupo, ano, ea, data, esforco) |> 
  count(uc, bioma, ano, ea, esforco)

#View(esforco_dia_trilha_rep)

## Estimando o esforço total naquela trilha por ano por UC

esforco_total_trilha <- esforco_dia_trilha |> # esforço total por trilha
  group_by(uc, bioma, grupo, ano, ea) |>
  summarise(extensao = sum(esforco))

#View(esforco_total_trilha)

# Checando trilhas com esforço > 50 km

checando_trilhas <- esforco_total_trilha |>
  filter(extensao > 50)

# print(checando_trilhas, n = 70)
# View(checando_trilhas)

```

```{r taxa_encontro_total, include = FALSE}


## Calculando o número de registros total

registros_total <- masto_aves_esforco |>
  group_by(uc, bioma, grupo, ano, ea)  |>
  count() |>
  drop_na()

#View(registros_total)

# juntanto tabelas esforco_total + registros_total

taxa_encontro_trilha_total <-
  left_join(registros_total, esforco_total_trilha, c("uc", "bioma", "grupo", "ano", "ea"))

#View(taxa_encontro_trilha_total)

taxa_encontro_trilha_total <- taxa_encontro_trilha_total |>
  mutate(taxa_encontro = (n/extensao) * 10)

#View(taxa_encontro_trilha_total)


# Taxa de encontro média/UC/ano

taxa_encontro_trilha_total_media <- taxa_encontro_trilha_total |>
  group_by(uc, bioma, grupo, ano) |>
  summarise(
    n = n(),
    taxa_enc_media = mean(taxa_encontro),
    dp = sd(taxa_encontro),
    ep = dp / (sqrt(n))
  )

#View(taxa_encontro_trilha_total_media)

```

```{r cálculo da taxa de encontro média do período - 2014-2022, include = FALSE}

## Calculando o número de registros total

registros_periodo_amostragem <- masto_aves_esforco |>
  group_by(uc, bioma, grupo, ano)  |>
  count() |>
  drop_na()

#View(registros_periodo_amostragem)

esforco_total_uc <- esforco_total_trilha |> 
  group_by(uc, bioma, grupo, ano) |>
  summarise(extensao_total = sum(extensao))

#View(esforco_total_uc)
  

# juntanto tabelas esforco + registros_total

taxa_encontro_periodo_amostragem <-
  left_join(registros_periodo_amostragem, esforco_total_uc, c("uc", "bioma", "grupo", "ano"))

#View(taxa_encontro_periodo_amostragem)

taxa_encontro_periodo_amostragem <- taxa_encontro_periodo_amostragem |>
  mutate(taxa_encontro = (n / extensao_total) * 10)

#View(taxa_encontro_periodo_amostragem)


taxa_encontro_periodo_amostragem <- taxa_encontro_periodo_amostragem |>
  group_by(uc, bioma, grupo) |>
  summarise(
    n = n(),
    taxa_enc_media = mean(taxa_encontro),
    dp = sd(taxa_encontro),
    ep = dp / (sqrt(n)),
    IC_95 = qnorm(.975)*ep,
  )


View(taxa_encontro_periodo_amostragem)

write.csv(taxa_encontro_periodo_amostragem, "planilhas/taxa_encontro_geral_periodo_amostragem.csv", row.names = FALSE)

```

```{r mapa taxa de encontro geral, echo = FALSE}

# ucs_monitora <- read_csv2("dados/ucs_federais_cnuc_15.09.2023.csv")
# 
# ucs_monitora$lat <- as.numeric(ucs_monitora$lat)
# ucs_monitora$long <- as.numeric(ucs_monitora$long)
  
#UC <-  readOGR("shapes/LimiteUCsFederais_jun_23.shp", verbose = FALSE)

ucs_comp_florestal <-  readOGR("shapes/ucs_comp_florestal.shp", verbose = FALSE)

#UC_monitora <-  readOGR("shapes/ucs_monitora_jun_23.shp", verbose = FALSE)

taxa_encontro_geral <- read_csv2("planilhas/taxa_encontro_geral_periodo_amostragem.csv")


ucs_comp_florestal_unido <- merge(ucs_comp_florestal, taxa_encontro_geral, by.x = "Cnuc", by.y = "Cnuc", all.x = TRUE, all.y = FALSE)

ucs_comp_florestal_unido
ucs_comp_florestal_unido <- round(ucs_comp_florestal_unido$taxa_enc_media, 2)

# ucs_comp_florestal_unido <- ucs_comp_florestal |> 
#   left_join(taxa_encontro_geral, by = c("Cnuc" = "Cnuc"))




# ucs <- st_read("shapes/ucs_comp_florestal.shp")
# brasil <- st_read("shapes/lim_pais_a.shp")
# 
# library(sf)
# library(ggplot2)

colours_red <- colorNumeric(palette = "Reds", domain = NULL)

mapa <- leaflet(ucs_comp_florestal_unido) |> 
  
  #Base groups
  setView(lng = -58, lat = -14,
           zoom = 4) %>%
  #addProviderTiles(providers$Stamen.TonerLite, group = "Stamen Toner Lite") %>%
  addProviderTiles(providers$OpenStreetMap.Mapnik, group = "Open Street Map") %>%
  addProviderTiles(providers$Esri.WorldImagery, group = "Imágenes de ESRI") %>%
  #addProviderTiles(providers$Esri.NatGeoWorldMap, group = "Esri.NatGeoWorldMap") %>%
  
  addPolygons(data = ucs_comp_florestal_unido,
    fillColor = ~ colours_red(n),
    fillOpacity = 0.75,
    weight = 2,
    color = "black",
    popup = paste("Nome: ", ucs_comp_florestal_unido$uc, "<br>",
                  "Bioma: ", ucs_comp_florestal_unido$BiomaCRL, "<br>",
                  "Taxa de encontro: ", ucs_comp_florestal_unido$n, "<br>")) |> 
  
  addLegend(
    pal = colours_red,
    values = ~ n,
    title = "Taxa de encontro",
    position = "bottomleft"
  ) |> 

# Layers Control

    addLayersControl(
        baseGroups = c(#"StamenTonerLite",
                       "Open Street Map",
                       "Imágenes de ESRI"),
                       #"Esri.NatGeoWorldMap"),
        position = "topright")
                          
mapa
 
# mapa <- ggplot() +
#   theme_classic() +
#   coord_sf() +
#   geom_sf(data = ucs_comp_florestal_unido, aes(fill = taxa_enc_media), size = 1.5, color = NA) +
#   scale_fill_viridis_d() +
#   geom_sf(data = brasil, size = 1.5, fill = NA) +
#   geom_sf(data = ucs, size = 1.5, fill = NA)
# 
# mapa

```

## Gráfico da taxa de encontro geral - 2014 a 2022 - mamíferos e aves juntos - barras

```{r G_taxa_encontro_geral_barras, echo = FALSE}

# Gráfico da taxa de encontro geral - mamíferos e aves juntos

G_taxa_encontro_geral_barras <- taxa_encontro_periodo_amostragem |>
 
  ggplot(aes(
    x = fct_reorder(uc, taxa_enc_media, .desc = F),
    y = taxa_enc_media
  )) +
  geom_col(fill = "#008B8B") +
  coord_flip() +
  scale_x_discrete(name = " ") +
  scale_y_continuous(name = "Registros/10 km") +
  theme_minimal() +
  theme(panel.grid.minor.y = element_blank(),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        #panel.grid.major.x = element_blank(),
        axis.text=element_text(size=6),
        axis.text.x = element_text(size = 9))+
  labs(title = "Taxa de encontro geral - mamíferos e aves juntos - 2014 a 2022")

G_taxa_encontro_geral_barras

ggsave("graficos/G_taxa_encontro_geral_barras.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

## Gráfico da taxa de encontro geral - 2014 a 2022 - mamíferos e aves juntos - médias e IC

```{r G_taxa_encontro_geral_media_IC, echo = FALSE}

# Gráfico da taxa de encontro geral - 2014 a 2022 - mamíferos e aves juntos - média e IC

G_taxa_encontro_geral_media_IC <- taxa_encontro_periodo_amostragem |>
 
  ggplot(aes(
    x = fct_reorder(uc, taxa_enc_media, .desc = F),
    y = taxa_enc_media
  )) +
  geom_point(color = "cyan4", size = 1) +
  geom_errorbar(
    aes(ymin = taxa_enc_media - IC_95, ymax = taxa_enc_media + IC_95),
    #size = 0.8,
    linewidth = 0.5,
    colour = "darkgreen"
  ) +
  coord_flip() +
  scale_x_discrete(name = " ") +
  scale_y_continuous(name = "Registros/10 km") +
  theme_minimal() +
  theme(panel.grid.minor.y = element_blank(),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        #panel.grid.major.x = element_blank(),
        axis.text=element_text(size=6),
        axis.text.x = element_text(size = 9)) +
  labs(title = "Taxa de encontro geral - mamíferos e aves - 2014 a 2022")

G_taxa_encontro_geral_media_IC

ggsave("graficos/G_taxa_encontro_geral_media_IC.png", height = 4.5, width = 6, units = "in", dpi = 300)


```

```{r G_taxa_encontro_geral_bioma_media_IC, echo = FALSE}

# Taxa de encontro geral por bioma - mamíferos e aves juntos - média e IC

G_taxa_encontro_geral_bioma_media_IC <- taxa_encontro_periodo_amostragem |> 
  group_by(bioma) |>
  summarise(
     n = n(),
     taxa_enc_media_bioma = mean(taxa_enc_media),
       dp = sd(taxa_enc_media, na.rm = TRUE),
       ep = dp / sqrt(n),
       IC_95 = qnorm(.975) * ep) |> 
  
  ggplot(aes(
    x = fct_reorder(bioma, taxa_enc_media_bioma, .desc = T),
    y = taxa_enc_media_bioma)) +
  geom_errorbar(
    aes(ymin = taxa_enc_media_bioma - IC_95, ymax = taxa_enc_media_bioma + IC_95),
    width = 0.07,
    size = 0.6,
    linewidth = 0.3
  ) +
  geom_point(aes(color = bioma), size = 4, show.legend = FALSE) +
  scale_color_manual(values = c("#006400", "#BF8120", "#a9a9a9")) +
  #coord_flip() +
  theme_minimal() +
  theme(axis.line.x=element_blank(),
        axis.line.y=element_blank(),
        axis.ticks.y = element_blank(),
        axis.ticks.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        #panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank(),
        axis.text=element_text(size=12),
        axis.title.y = element_text(margin = margin(r = 20))) +
        scale_x_discrete(name = " ") +
  scale_y_continuous(limits = c(0, 20)) +
  labs(title = "Taxa de encontro geral por bioma - mamíferos e aves - 2014 a 2022",            y = "Registros/10 km")


G_taxa_encontro_geral_bioma_media_IC

ggsave("graficos/G_taxa_encontro_geral_bioma_media_IC.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

## Gráfico da taxa de encontro geral por bioma - mamíferos e aves juntos

```{r G_taxa_encontro_geral_bioma_box_plot, echo = FALSE}


# Taxa de encontro geral por bioma box-plot - mamíferos e aves juntos

G_taxa_encontro_geral_bioma_box_plot <- taxa_encontro_periodo_amostragem |>
  
  ggplot(aes(y = taxa_enc_media, x = bioma)) +
  geom_errorbar(stat = "boxplot", width = 0.05) +
  geom_boxplot(aes(fill = bioma), width = 0.3,
               outlier.shape = 1, outlier.color = NA,
               show.legend = FALSE) +
  geom_point(stat = "summary", fun = "mean", shape = 4,
             size = 2, color = "darkgreen") +
  scale_fill_manual(values = c("#006400", "#BF8120", "#a9a9a9")) +
  theme_minimal() +
  theme(axis.line.x=element_blank(),
        axis.line.y=element_blank(),
        axis.ticks.y = element_blank(),
        axis.ticks.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        #panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank(),
        axis.text=element_text(size=10),
        axis.title.y = element_text(margin = margin(r = 15))) +
        scale_y_continuous(limits = c(0, 25)) +
  labs(title = "Taxa de encontro geral por bioma - mamíferos e aves - 2014 a 2022",            x = " ", y = "Regsitros/10 km")


G_taxa_encontro_geral_bioma_box_plot

ggsave("graficos/G_taxa_encontro_geral_bioma_box_plot.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

## Gráfico da taxa de encontro geral por grupo de UC - mamíferos e aves juntos - 2014 a 2022

```{r G_taxa_encontro_geral_densidade_grupo, echo = FALSE}


G_taxa_encontro_geral_densidade_grupo <- taxa_encontro_periodo_amostragem |>
  
ggplot(aes(x = taxa_enc_media, fill = grupo)) +
  geom_density(alpha = .3) +
    scale_fill_manual(values = c("#359780", "#BF8120")) +
    theme_minimal() +
    theme(axis.line.x=element_blank(),
        axis.line.y=element_blank(),
        axis.ticks.y = element_blank(),
        axis.ticks.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        #panel.grid.major.y = element_blank(),
        legend.title = element_blank(),
        legend.position = c(0.75, 0.85),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank(),
        axis.text=element_text(size=12),
        axis.title.y = element_text(margin = margin(r = 20))) +
        scale_y_continuous(limits = c(0, 0.10)) +
    labs(title = "Distribuição das taxas de encontro geral - mamíferos e aves - por grupo de UC", x = "Registros/10 km", y = "Densidade", fill = "Grupo")


G_taxa_encontro_geral_densidade_grupo

ggsave("graficos/G_taxa_encontro_geral_densidade_grupo.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

```{r G_taxa_encontro_geral_histograma_grupo, echo = FALSE}

G_taxa_encontro_geral_histograma_grupo <- taxa_encontro_periodo_amostragem |>

ggplot(aes(x = taxa_enc_media, fill = grupo)) +
  geom_bar(alpha = 0.3, position = "identity") +
  scale_x_binned() +
  scale_fill_manual(values = c("#359780", "#BF8120")) +
  theme_minimal() +
  theme(axis.line.x=element_blank(),
        axis.line.y=element_blank(),
        axis.ticks.y = element_blank(),
        axis.ticks.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        #panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank(),
        legend.title = element_blank(),
        legend.position = c(0.75, 0.8),
        axis.text=element_text(size=10),
        axis.title.y = element_text(margin = margin(r = 20))) +
        scale_y_continuous(limits = c(0, 15)) +
  labs(title = "Distribuição das taxas de encontro - mamíferos e aves - média geral por UC", x = "Registros/10 km", y = "Frequência absoluta", fill = "Grupo")

G_taxa_encontro_geral_histograma_grupo

ggsave("graficos/G_taxa_encontro_geral_histograma_grupo.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

## Gráfico da taxa de encontro geral por grupo

```{r G_taxa_encontro_geral_box_plot_grupo, echo = FALSE}

# Taxa de encontro geral por grupo 

G_taxa_encontro_geral_box_plot_grupo <- taxa_encontro_periodo_amostragem |>
  #group_by(grupo) |> 
  # summarise(
  #   n = n(),
  #   taxa_enc_media = mean(taxa_enc_media),
  #   dp = sd(taxa_enc_media),
  #   ep = dp / (sqrt(n)),
  #   IC_95 = qnorm(.975)*ep) |>
  
  ggplot(aes(y = taxa_enc_media, x = grupo)) +
  geom_errorbar(stat = "boxplot", width = 0.05) +
  geom_boxplot(aes(fill = grupo), width = 0.3,
               outlier.shape = 1, outlier.color = NA,
               show.legend = FALSE) +
  geom_point(stat = "summary", fun = "mean", shape = 4,
             size = 2) +
  scale_fill_manual(values = c("#359780", "#BF8120")) +
  theme_minimal() +
  theme(axis.line.x=element_blank(),
        axis.line.y=element_blank(),
        axis.ticks.y = element_blank(),
        axis.ticks.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        #panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank(),
        axis.text=element_text(size=12),
        axis.title.y = element_text(margin = margin(r = 20))) +
        scale_y_continuous(limits = c(0, 30)) +
 labs(title = "Taxa de encontro geral por grupo - mamíferos e aves - 2014 a 2022", y = "Registros/10 km", x = " ")
  
G_taxa_encontro_geral_box_plot_grupo 

ggsave("graficos/G_taxa_encontro_geral_box_plot_grupo.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

```{r G_taxa_encontro_geral_grupo_media_IC, echo = FALSE}

# Taxa de encontro geral por grupo - média e IC


G_taxa_encontro_geral_grupo_media_IC <- taxa_encontro_periodo_amostragem |>
  group_by(grupo) |>
  summarise(
    n = n(),
    taxa_enc_media_grupo = mean(taxa_enc_media),
    dp = sd(taxa_enc_media),
    ep = dp / (sqrt(n)),
    IC_95 = qnorm(.975)*ep) |>
  
ggplot(aes(
    x = fct_reorder(grupo, taxa_enc_media_grupo, .desc = F),
    y = taxa_enc_media_grupo)) +
  geom_errorbar(
    aes(ymin = taxa_enc_media_grupo - IC_95, ymax = taxa_enc_media_grupo + IC_95),
    width = 0.07,
    size = 0.6,
    linewidth = 0.3
    ) +
  geom_point(aes(color = grupo), size = 4, show.legend = FALSE) +
  scale_color_manual(values = c("#359780", "#BF8120")) +
  #coord_flip() +
  theme_minimal() +
  theme(axis.line.x=element_blank(),
        axis.line.y=element_blank(),
        axis.ticks.y = element_blank(),
        axis.ticks.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        #panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank(),
        axis.text=element_text(size=12),
        axis.title.y = element_text(margin = margin(r = 20))) +
        scale_x_discrete(name = " ") +
        scale_y_continuous(limits = c(0, 20)) +
 labs(title = "Taxa de encontro geral por grupo - mamíferos e aves - 2014 a 2022", y = "Registros/10 km", x = " ")
  
G_taxa_encontro_geral_grupo_media_IC 

ggsave("graficos/G_taxa_encontro_geral_grupo_media_IC.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

```{r taxa de encontro amostragem total por classe - 2014 a 2022}

## Calculando o número de registros total

registros_periodo_amostragem_classe <- masto_aves_esforco |>
  group_by(uc, bioma, grupo, ano, classe)  |>
  count() |>
  drop_na()

View(registros_periodo_amostragem_classe)

esforco_total_uc <- esforco_total_trilha |> 
  group_by(uc, bioma, grupo, ano) |>
  summarise(extensao_total = sum(extensao))

View(esforco_total_uc)
  

# juntanto tabelas esforco + registros_total

taxa_encontro_periodo_amostragem_classe <-
  left_join(registros_periodo_amostragem_classe, esforco_total_uc, c("uc", "bioma", "grupo", "ano"))

View(taxa_encontro_periodo_amostragem_classe)

taxa_encontro_periodo_amostragem_classe <- taxa_encontro_periodo_amostragem_classe |>
  mutate(taxa_encontro = (n / extensao_total) * 10)

View(taxa_encontro_periodo_amostragem_classe)


taxa_encontro_periodo_amostragem_classe <- taxa_encontro_periodo_amostragem_classe |>
  group_by(uc, bioma, grupo, classe) |>
  summarise(
    n = n(),
    taxa_enc_media = mean(taxa_encontro),
    dp = sd(taxa_encontro),
    ep = dp / (sqrt(n)),
    IC_95 = qnorm(.975)*ep 
  )


View(taxa_encontro_periodo_amostragem_classe)

```

## Gráfico da taxa de encontro geral - mamíferos e aves por bioma - emparelhado

```{r G_taxa_encontro_geral_bioma_emparelhado_box_plot, echo = FALSE}

# Taxa de encontro geral mamíferos e aves por bioma - emparelhado

G_taxa_encontro_geral_bioma_emparelhado_box_plot <- taxa_encontro_periodo_amostragem_classe |> 

  ggplot(aes(y = taxa_enc_media, x = bioma, fill = classe)) +
  geom_errorbar(stat = "boxplot", width = 0.05,
                position = position_dodge(width = 0.75), 
                show.legend = TRUE) +
  geom_boxplot(width = 0.3, position = position_dodge(width = 0.75),       outlier.color = NA, show.legend = TRUE) +
  geom_point(stat = "summary", fun = "mean", shape = 4,
             size = 2, position = position_dodge(width = 0.75)) +
  scale_fill_manual(values = c("#359780", "#BF8120")) +
  theme_minimal() +
  theme(axis.line.x=element_blank(),
        axis.line.y=element_blank(),
        axis.ticks.y = element_blank(),
        axis.ticks.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        #panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank(),
        legend.position = c(0.8,0.7),
        legend.title = element_blank(),
        axis.text=element_text(size=10),
        axis.title.y = element_text(margin = margin(r = 22))) +
        scale_y_continuous(limits = c(0, 25)) +
  labs(title = "Taxa de encontro geral por bioma - mamíferos e aves emparelhados - 2014 a 2022", x = " ", y = "Registros/10 km")

G_taxa_encontro_geral_bioma_emparelhado_box_plot

ggsave("graficos/G_taxa_encontro_geral_bioma_emparelhado_box_plot.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

```{r G_taxa_encontro_geral_bioma_emparelhado_media_IC, echo = FALSE}

# Taxa de encontro geral mamíferos e aves por bioma - emparelhado

G_taxa_encontro_geral_bioma_emparelhado_media_IC <- taxa_encontro_periodo_amostragem_classe |> 
 group_by(bioma, classe) |> 
 summarise(
     n = n(),
     taxa_enc_media_bioma = mean(taxa_enc_media),
       dp = sd(taxa_enc_media, na.rm = TRUE),
       ep = dp / sqrt(n),
       IC_95 = qnorm(.975) * ep) |> 

  # View(G_taxa_encontro_geral_bioma_emparelhado_media_IC)

  ggplot(aes(
    x = fct_reorder(bioma, taxa_enc_media_bioma, .desc = T),
    y = taxa_enc_media_bioma)) +
  geom_errorbar(
    aes(ymin = taxa_enc_media_bioma - IC_95, ymax =             taxa_enc_media_bioma + IC_95), 
    position = "dodge2",
    width = 0.1,
    size = 0.6,
    linewidth = 0.3
  ) +
  geom_point(aes(colour = classe), size = 3, position = position_dodge2(width = 0.1)) +
  scale_color_manual(values = c("#359780", "#BF8120")) +
  theme_minimal() +
  theme(axis.line.x=element_blank(),
        axis.line.y=element_blank(),
        axis.ticks.y = element_blank(),
        axis.ticks.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        #panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank(),
        legend.title = element_blank(),
        legend.position = c(0.75, 0.8),
        axis.text=element_text(size=11),
        axis.title.y = element_text(margin = margin(r = 20))) +
        scale_x_discrete(name = " ") +
        scale_y_continuous(limits = c(0, 15)) +
  labs(title = "Taxa de encontro geral por bioma - mamíferos e aves - 2014 a 2022", x = " ", y = "Registros/10 km")


G_taxa_encontro_geral_bioma_emparelhado_media_IC

ggsave("graficos/G_taxa_encontro_geral_bioma_emparelhado_media_IC.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

```{r G_taxa_encontro_geral_mamiferos_bioma_densidade, echo = FALSE}

G_taxa_encontro_geral_mamiferos_bioma_densidade <- taxa_encontro_periodo_amostragem_classe |> 
  filter(classe == "Mammalia") |> 

ggplot(aes(x = taxa_enc_media, fill = bioma)) +
  geom_density(alpha = 0.4) +
    scale_fill_manual(values = c("#006400", "#BF8120", "#a9a9a9")) +
    theme_minimal() +
    theme(axis.line.x=element_blank(),
        axis.line.y=element_blank(),
        axis.ticks.y = element_blank(),
        axis.ticks.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        #panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank(),
        legend.position = c(0.8,0.8),
        legend.title = element_blank(),
        axis.text=element_text(size=12),
        axis.title.y = element_text(margin = margin(r = 15)),
        axis.title.x = element_text(margin = margin(t = 10))) +
        scale_y_continuous(limits = c(0, 0.15)) +
   labs(title = "Distribuição das taxas de encontro de mamíferos por bioma", x = "Registros/10 km", y = "Densidade", fill = "Bioma")

G_taxa_encontro_geral_mamiferos_bioma_densidade

ggsave("graficos/G_taxa_encontro_geral_mamiferos_bioma_densidade.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

```{r G_taxa_encontro_geral_mamiferos_bioma_histograma, echo = FALSE}

G_taxa_encontro_geral_mamiferos_bioma_histograma <- taxa_encontro_periodo_amostragem_classe |> 
  filter(classe == "Mammalia") |> 

#View(G_taxa_encontro_geral_mamiferos_bioma_histograma)

ggplot(aes(x = taxa_enc_media, fill = bioma)) +
  geom_bar(alpha = 0.3, position = "identity") +
    scale_x_binned(n.breaks = 10) +
    scale_fill_manual(values = c("#006400", "#BF8120", "#a9a9a9")) +
    theme_minimal() +
    theme(axis.line.x=element_blank(),
        axis.line.y=element_blank(),
        axis.ticks.y = element_blank(),
        axis.ticks.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        #panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank(),
        legend.position = c(0.8,0.88),
        legend.title = element_blank(),
        axis.text=element_text(size=12),
        axis.title.y = element_text(margin = margin(r = 15)),
        axis.title.x = element_text(margin = margin(t = 10))) +
        scale_y_continuous(limits = c(0, 10), breaks = c(0, 2, 4, 6, 8, 10)) +
    labs(title = "Distribuição das taxas de encontro de mamíferos por bioma", x = "Registros/10 km", y = "Frequência absoluta", fill = " ")

G_taxa_encontro_geral_mamiferos_bioma_histograma

ggsave("graficos/G_taxa_encontro_geral_mamiferos_bioma_histograma.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

## Gráfico da taxa de encontro geral mamíferos por bioma

```{r G_taxa_encontro_geral_mamiferos_bioma_box_plot, echo = FALSE}

# Taxa de encontro geral - mamíferos por bioma 

G_taxa_encontro_geral_mamiferos_bioma_box_plot <- taxa_encontro_periodo_amostragem_classe |>
  filter(classe == "Mammalia") |> 
  
  ggplot(aes(y = taxa_enc_media, x = bioma)) +
  geom_errorbar(stat = "boxplot", width = 0.05) +
  geom_boxplot(aes(fill = bioma), width = 0.3,
               outlier.shape = 1, outlier.color = NA,
               show.legend = FALSE) +
  geom_point(stat = "summary", fun = "mean", shape = 4) +
  scale_fill_manual(values = c("#006400", "#BF8120", "#a9a9a9")) +
  theme_minimal() +
  theme(axis.line.x=element_blank(),
        axis.line.y=element_blank(),
        axis.ticks.y = element_blank(),
        axis.ticks.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        #panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank(),
        axis.text=element_text(size=12),
        axis.title.y = element_text(margin = margin(r = 15))) +
        scale_y_continuous(limits = c(0, 25)) +
  labs(title = "Taxa de encontro geral mamíferos por bioma - 2014 a 2022", x = " ", y = "Registros/10 km")

G_taxa_encontro_geral_mamiferos_bioma_box_plot

ggsave("graficos/G_taxa_encontro_geral_mamiferos_bioma_box_plot.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

```{r G_taxa_encontro_geral_mamiferos_bioma_media_IC, echo = FALSE}

# Taxa de encontro geral - mamíferos por bioma 

G_taxa_encontro_geral_mamiferos_bioma_media_IC <- taxa_encontro_periodo_amostragem_classe |>
  filter(classe == "Mammalia") |> 
  group_by(bioma) |>
  summarise(
    n = n(),
    taxa_enc_media_bioma = mean(taxa_enc_media),
    dp = sd(taxa_enc_media),
    ep = dp / (sqrt(n)),
    IC_95 = qnorm(.975)*ep) |>
  
ggplot(aes(
    x = fct_reorder(bioma, taxa_enc_media_bioma, .desc = T),
    y = taxa_enc_media_bioma)) +
  geom_errorbar(
    aes(ymin = taxa_enc_media_bioma - IC_95, ymax = taxa_enc_media_bioma + IC_95),
    width = 0.07,
    size = 0.6,
    linewidth = 0.3
  ) +
  geom_point(aes(color = bioma), size = 4, show.legend = FALSE) +
  scale_color_manual(values = c("#006400", "#BF8120", "#a9a9a9")) +
  #coord_flip() +
  theme_minimal() +
  theme(axis.line.x=element_blank(),
        axis.line.y=element_blank(),
        axis.ticks.y = element_blank(),
        axis.ticks.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        #panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank(),
        axis.text=element_text(size=12),
        axis.title.y = element_text(margin = margin(r = 20))) +
        scale_x_discrete(name = " ") +
        scale_y_continuous(limits = c(0, 15)) +
  labs(title = "Taxa de encontro geral mamíferos por bioma - 2014 a 2022", x = " ", y = "Registros/10 km")

G_taxa_encontro_geral_mamiferos_bioma_media_IC

ggsave("graficos/G_taxa_encontro_geral_mamiferos_bioma_media_IC.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

```{r G_taxa_encontro_geral_aves_bioma_densidade, echo = FALSE}

G_taxa_encontro_geral_aves_bioma_densidade <- taxa_encontro_periodo_amostragem_classe |> 
  filter(classe == "Aves") |> 

ggplot(aes(x = taxa_enc_media, fill = bioma)) +
  geom_density(alpha = .4) +
    scale_fill_manual(values = c("#006400", "#BF8120", "#a9a9a9")) +
    theme_minimal() +
    theme(axis.line.x=element_blank(),
        axis.line.y=element_blank(),
        axis.ticks.y = element_blank(),
        axis.ticks.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        #panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank(),
        legend.position = c(0.8,0.77),
        legend.title = element_blank(),
        axis.text=element_text(size=10),
        axis.title.y = element_text(margin = margin(r = 15)),
        axis.title.x = element_text(margin = margin(t = 10))) +
        scale_y_continuous(limits = c(0, 0.45)) +
   labs(title = "Distribuição das taxas de encontro de aves por bioma", x = "Registros/10 km", y = "Densidade", fill = "Bioma")

G_taxa_encontro_geral_aves_bioma_densidade

ggsave("graficos/G_taxa_encontro_geral_aves_bioma_densidade.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

```{r G_taxa_encontro_geral_aves_bioma_histograma, echo = FALSE}

G_taxa_encontro_geral_aves_bioma_histograma <- taxa_encontro_periodo_amostragem_classe |> 
  filter(classe == "Aves") |> 

ggplot(aes(x = taxa_enc_media, fill = bioma)) +
  geom_bar(alpha = 0.3, position = "identity") +
    scale_x_binned(n.breaks = 10) +
    scale_fill_manual(values = c("#006400", "#BF8120", "#a9a9a9")) +
    theme_minimal() +
    theme(axis.line.x=element_blank(),
        axis.line.y=element_blank(),
        axis.ticks.y = element_blank(),
        axis.ticks.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        #panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank(),
        legend.position = c(0.8,0.88),
        legend.title = element_blank(),
        axis.text=element_text(size=12),
        axis.title.y = element_text(margin = margin(r = 15)),
        axis.title.x = element_text(margin = margin(t = 10))) +
        scale_y_continuous(limits = c(0, 10), breaks = c(0, 2, 4, 6, 8, 10)) +
    labs(title = "Distribuição das taxas de encontro de aves por bioma", x = "Registros/10 km", y = "Frequência absoluta", fill = " ")

G_taxa_encontro_geral_aves_bioma_histograma

ggsave("graficos/G_taxa_encontro_geral_aves_bioma_histograma.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

## Gráfico da taxa de encontro geral aves por bioma

```{r G_taxa_encontro_geral_aves_bioma_box_plot, echo = FALSE}

# Taxa de encontro geral aves por bioma - box-plot

G_taxa_encontro_geral_aves_bioma_box_plot <- taxa_encontro_periodo_amostragem_classe |>
  filter(classe == "Aves") |> 
  
  ggplot(aes(y = taxa_enc_media, x = bioma)) +
  geom_errorbar(stat = "boxplot", width = 0.05) +
  geom_boxplot(aes(fill = bioma), width = 0.3,
               outlier.shape = 1, outlier.color = NA,
               show.legend = FALSE) +
  geom_point(stat = "summary", fun = "mean", shape = 4,
             size = 2) +
  scale_fill_manual(values = c("#006400", "#BF8120", "#a9a9a9")) +
  theme_minimal() +
  theme(axis.line.x=element_blank(),
        axis.line.y=element_blank(),
        axis.ticks.y = element_blank(),
        axis.ticks.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        #panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank(),
        axis.text=element_text(size=10),
        axis.title.y = element_text(margin = margin(r = 15))) +
        scale_y_continuous(limits = c(0, 8)) +
  labs(title = "Taxa de encontro geral aves por bioma - 2014 a 2022", x = " ", y = "Registros/10 km")


G_taxa_encontro_geral_aves_bioma_box_plot

ggsave("graficos/G_taxa_encontro_geral_aves_bioma_box_plot.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

```{r G_taxa_encontro_geral_aves_bioma_media_IC, echo = FALSE}

# Taxa de encontro geral - aves por bioma 

G_taxa_encontro_geral_aves_bioma_media_IC <- taxa_encontro_periodo_amostragem_classe |>
  filter(classe == "Aves") |> 
  group_by(bioma) |>
  summarise(
    n = n(),
    taxa_enc_media_bioma = mean(taxa_enc_media),
    dp = sd(taxa_enc_media),
    ep = dp / (sqrt(n)),
    IC_95 = qnorm(.975)*ep) |>
  
  ggplot(aes(
    x = fct_reorder(bioma, taxa_enc_media_bioma, .desc = T),
    y = taxa_enc_media_bioma)) +
  geom_errorbar(
    aes(ymin = taxa_enc_media_bioma - IC_95, ymax = taxa_enc_media_bioma + IC_95),
    width = 0.07,
    size = 0.6,
    linewidth = 0.3
    ) +
  geom_point(aes(color = bioma), size = 4, show.legend = FALSE) +
  scale_color_manual(values = c("#006400", "#BF8120", "#a9a9a9")) +
  #coord_flip() +
  theme_minimal() +
  theme(axis.line.x=element_blank(),
        axis.line.y=element_blank(),
        axis.ticks.y = element_blank(),
        axis.ticks.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        #panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank(),
        axis.text=element_text(size=12),
        axis.title.y = element_text(margin = margin(r = 20))) +
        scale_x_discrete(name = " ") +
        scale_y_continuous(limits = c(0, 6)) +
  labs(title = "Taxa de encontro geral de aves por bioma - 2014 a 2022", x = " ", y = "Registros/10 km")

G_taxa_encontro_geral_aves_bioma_media_IC

ggsave("graficos/G_taxa_encontro_geral_aves_bioma_media_IC.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

## Gráfico da taxa de encontro geral de mamíferos por grupo de UC - 2014 a 2022

```{r G_taxa_encontro_geral_mamiferos_densidade_grupo, echo = FALSE}


G_taxa_encontro_geral_mamiferos_densidade_grupo <- taxa_encontro_periodo_amostragem_classe |>
  filter(classe == "Mammalia") |> 
  
ggplot(aes(x = taxa_enc_media, fill = grupo)) +
  geom_density(alpha = .4) +
    scale_fill_manual(values = c("#006400", "#BF8120")) +
    theme_minimal() +
    theme(axis.line.x=element_blank(),
        axis.line.y=element_blank(),
        axis.ticks.y = element_blank(),
        axis.ticks.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        #panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank(),
        legend.position = c(0.8,0.87),
        legend.title = element_blank(),
        axis.text=element_text(size=10),
        axis.title.y = element_text(margin = margin(r = 15)),
        axis.title.x = element_text(margin = margin(t = 10))) +
        scale_y_continuous(limits = c(0, 0.10)) +
   labs(title = "Distribuição das taxas de encontro de mamíferos por grupo de UC", x = "Registros/10 km", y = "Densidade", fill = "Grupo")

G_taxa_encontro_geral_mamiferos_densidade_grupo

ggsave("graficos/G_taxa_encontro_geral_mamiferos_densidade_grupo.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

```{r G_taxa_encontro_geral_mamiferos_histograma_grupo, echo = FALSE}


G_taxa_encontro_geral_mamiferos_histograma_grupo <- taxa_encontro_periodo_amostragem_classe |>
  filter(classe == "Mammalia") |> 
  
ggplot(aes(x = taxa_enc_media, fill = grupo)) +
  geom_bar(alpha = 0.3, position = "identity") +
  scale_x_binned() +
  scale_fill_manual(values = c("#006400", "#BF8120")) +
  theme_minimal() +
  theme(axis.line.x=element_blank(),
        axis.line.y=element_blank(),
        axis.ticks.y = element_blank(),
        axis.ticks.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        #panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank(),
        legend.title = element_blank(),
        legend.position = c(0.75, 0.85),
        axis.text=element_text(size=10),
        axis.title.y = element_text(margin = margin(r = 20))) +
        scale_y_continuous(limits = c(0, 8), breaks = c(0, 2, 4, 6, 8, 10)) +
  labs(title = "Distribuição das taxas de encontro - mamíferos", x = "Registros/10 km", y = "Frequência absoluta", fill = "Grupo")

G_taxa_encontro_geral_mamiferos_histograma_grupo

ggsave("graficos/G_taxa_encontro_geral_mamiferos_histograma_grupo.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

## Gráfico da taxa de encontro geral de aves por grupo de UC - 2014 a 2022

```{r G_taxa_encontro_geral_aves_densidade_grupo, echo = FALSE}

G_taxa_encontro_geral_aves_densidade_grupo <- taxa_encontro_periodo_amostragem_classe |>
  filter(classe == "Aves") |> 
  
ggplot(aes(x = taxa_enc_media, fill = grupo)) +
  geom_density(alpha = .4) +
    scale_fill_manual(values = c("#006400", "#BF8120")) +
    theme_minimal() +
    theme(axis.line.x=element_blank(),
        axis.line.y=element_blank(),
        axis.ticks.y = element_blank(),
        axis.ticks.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        #panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank(),
        legend.position = c(0.8,0.87),
        legend.title = element_blank(),
        axis.text=element_text(size=10),
        axis.title.y = element_text(margin = margin(r = 15)),
        axis.title.x = element_text(margin = margin(t = 10))) +
        scale_y_continuous(limits = c(0, 0.25)) +
    labs(title = "Distribuição das taxas de encontro de aves por grupo de UC", x = "Registros/10 km", y = "Densidade", fill = "Grupo")

G_taxa_encontro_geral_aves_densidade_grupo

ggsave("graficos/G_taxa_encontro_geral_aves_densidade_grupo.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

```{r G_taxa_encontro_geral_aves_histograma_grupo, echo = FALSE}


G_taxa_encontro_geral_aves_histograma_grupo <- taxa_encontro_periodo_amostragem_classe |>
  filter(classe == "Aves") |> 
  
ggplot(aes(x = taxa_enc_media, fill = grupo)) +
    # geom_histogram(alpha = .3, position = "identity", bins = 5) +
  geom_bar(alpha = 0.3, position = "identity") +
  scale_x_binned() +
  scale_fill_manual(values = c("#006400", "#BF8120")) +
  theme_minimal() +
  theme(axis.line.x=element_blank(),
        axis.line.y=element_blank(),
        axis.ticks.y = element_blank(),
        axis.ticks.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        #panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank(),
        legend.title = element_blank(),
        legend.position = c(0.75, 0.88),
        axis.text=element_text(size=10),
        axis.title.y = element_text(margin = margin(r = 20))) +
        scale_y_continuous(limits = c(0, 10), breaks = c(0, 2, 4, 6, 8, 10)) +
        #scale_x_continuous(limits = c(0, 30)) +
  labs(title = "Distribuição das taxas de encontro - aves", x = "Registros/10 km", y = "Frequência absoluta", fill = "Grupo")

G_taxa_encontro_geral_aves_histograma_grupo

ggsave("graficos/G_taxa_encontro_geral_aves_histograma_grupo.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

```{r G_taxa_encontro_total_ucs_ano_barras, echo = FALSE}

# Gráfico da taxa de encontro total por uc e por ano ano - mamíferos e aves juntos

G_taxa_encontro_total_ucs_ano_barras <- taxa_encontro_trilha_total_media |>
  filter(ano == 2022) |>
  
  ggplot(aes(
    x = fct_reorder(uc, taxa_enc_media, .desc = F),
    y = taxa_enc_media
  )) +
  geom_col(fill = "#008B8B") +
  coord_flip() +
  scale_x_discrete(name = " ") +
  scale_y_continuous(name = "Registros/10 km") +
  theme_minimal() +
  theme(panel.grid.minor.y = element_blank(),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        #panel.grid.major.x = element_blank(),
        axis.text=element_text(size=6)) +
  labs(title = "Taxa de encontro total - mamíferos e aves - por UC - 2022")


G_taxa_encontro_total_ucs_ano_barras

ggsave("graficos/G_taxa_encontro_total_ucs_ano_barras.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

```{r cálculo da taxa de encontro por classe, include = FALSE}


## Calculando o número de registros por classe, por trilha, por ano e por UC

registros_classe <- masto_aves_esforco |>
  group_by(uc, ano, ea, classe)  |>
  count() |>
  drop_na(classe)

#View(registros_classe)


# juntanto tabelas esforco + registros_classe

taxa_encontro_trilha_classe <-
  left_join(registros_classe, esforco_total_trilha, c("uc", "ano", "ea"))

#View(taxa_encontro_trilha_classe)

taxa_encontro_trilha_classe <- taxa_encontro_trilha_classe |>
  mutate(taxa_encontro = (n / extensao) * 10)

#View(taxa_encontro_trilha_classe)


taxa_encontro_trilha_classe <- taxa_encontro_trilha_classe |>
  group_by(uc, ano, classe) |>
  summarise(
    n = n(),
    taxa_enc_media = mean(taxa_encontro),
    dp = sd(taxa_encontro),
    ep = dp / (sqrt(n)),
    IC_95 = qnorm(.975) * ep)
  
#View(taxa_encontro_trilha_classe)

```

```{r G_taxa_encontro_geral_mamiferos_barras, echo = FALSE}

# Gráfico da taxa de encontro total 2014 a 2022 - mamíferos

G_taxa_encontro_geral_mamiferos_barras <- taxa_encontro_periodo_amostragem_classe |>
  filter(classe == "Mammalia") |> 

  ggplot(aes(
    x = fct_reorder(uc, taxa_enc_media, .desc = F),
    y = taxa_enc_media
  )) +
  geom_col(fill = "#008B8B") +
  coord_flip() +
  scale_x_discrete(name = " ") +
  scale_y_continuous(name = "Registros/10 km") +
  theme_minimal() +
  theme(panel.grid.minor.y = element_blank(),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        #panel.grid.major.x = element_blank(),
        axis.text=element_text(size=6)) +
  labs(title = "Taxa de encontro geral - mamíferos - 2014 a 2022")

G_taxa_encontro_geral_mamiferos_barras

ggsave("graficos/G_taxa_encontro_geral_mamiferos_barras.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

```{r G_taxa_encontro_geral_mamiferos_media_IC, echo = FALSE}

# Gráfico da taxa de encontro total 2014 a 2022 - mamíferos média e IC


G_taxa_encontro_geral_mamiferos_media_IC <- taxa_encontro_periodo_amostragem_classe |>
  filter(classe == "Mammalia") |>

    ggplot(aes(
    x = fct_reorder(uc, taxa_enc_media, .desc = F),
    y = taxa_enc_media
  )) +
  geom_point(color = "cyan4", size = 1) +
  geom_errorbar(
    aes(ymin = taxa_enc_media - IC_95, ymax = taxa_enc_media + IC_95),
    #size = 0.8,
    linewidth = 0.5,
    colour = "darkgreen"
  ) +
  coord_flip() +
  scale_x_discrete(name = " ") +
  scale_y_continuous(name = "Registros/10 km") +
  theme_minimal() +
  theme(panel.grid.minor.y = element_blank(),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        #panel.grid.major.x = element_blank(),
        axis.text=element_text(size=6)) +
  labs(title = "Taxa de encontro geral - mamíferos - 2014 a 2022")

G_taxa_encontro_geral_mamiferos_media_IC

ggsave("graficos/G_taxa_encontro_geral_mamiferos_media_IC.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

```{r G_taxa_encontro_geral_aves_barras, echo = FALSE}

# Gráfico da taxa de encontro total 2014 a 2022 - aves

G_taxa_encontro_geral_aves_barras <- taxa_encontro_periodo_amostragem_classe |>
  filter(classe == "Aves") |> 
 
  ggplot(aes(
    x = fct_reorder(uc, taxa_enc_media, .desc = F),
    y = taxa_enc_media
  )) +
  geom_col(fill = "#008B8B") +
  coord_flip() +
  scale_x_discrete(name = " ") +
  scale_y_continuous(name="Registros/10 km", limits=c(0, 20), breaks=c(0, 5, 10, 15, 20)) +
  theme_minimal() +
  theme(panel.grid.minor.y = element_blank(),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        #panel.grid.major.x = element_blank(),
        axis.text=element_text(size=6)) +
  labs(title = "Taxa de encontro geral - aves - 2014 a 2022") 
 
G_taxa_encontro_geral_aves_barras

ggsave("graficos/G_taxa_encontro_geral_aves_barras.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

```{r G_taxa_encontro_geral_aves_media_IC, echo = FALSE}

# Gráfico da taxa de encontro total 2014 a 2022 - aves média e IC


G_taxa_encontro_geral_aves_media_IC <- taxa_encontro_periodo_amostragem_classe |>
  filter(classe == "Aves") |>

    ggplot(aes(
    x = fct_reorder(uc, taxa_enc_media, .desc = F),
    y = taxa_enc_media
  )) +
  geom_point(color = "cyan4", size = 1) +
  geom_errorbar(
    aes(ymin = taxa_enc_media - IC_95, ymax = taxa_enc_media + IC_95),
    #size = 0.8,
    linewidth = 0.5,
    colour = "darkgreen"
  ) +
  coord_flip() +
  scale_x_discrete(name = " ") +
  scale_y_continuous(name = "Registros/10 km") +
  theme_minimal() +
  theme(panel.grid.minor.y = element_blank(),
        panel.grid.major.y = element_blank(),
        axis.text=element_text(size=7)) +
  labs(title = "Taxa de encontro geral - aves - 2014 a 2022")

G_taxa_encontro_geral_aves_media_IC

ggsave("graficos/G_taxa_encontro_geral_aves_media_IC.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

## Gráfico da taxa de encontro total por grupos mamíferos e aves emparelhados

```{r G_taxa_encontro_geral_grupo_emparelhado_box_plot, echo = FALSE}


# Taxa de encontro total por grupos mamíferos e aves emparelhados

G_taxa_encontro_geral_grupo_emparelhado_box_plot <- taxa_encontro_periodo_amostragem_classe |>
  ggplot(aes(y = taxa_enc_media, x = grupo, fill = classe)) +
  geom_errorbar(stat = "boxplot", width = 0.05,
                position = position_dodge(width = 0.75), 
                show.legend = TRUE) +
  geom_boxplot(width = 0.3, position = position_dodge(width = 0.75),   outlier.color = NA, show.legend = TRUE) +
  geom_point(stat = "summary", fun = "mean", shape = 4,
             size = 2, position = position_dodge(width = 0.75)) +
  scale_fill_manual(values = c("#006400", "#BF8120")) +
  theme_minimal() +
  theme(axis.line.x=element_blank(),
        axis.line.y=element_blank(),
        axis.ticks.y = element_blank(),
        axis.ticks.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        #panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank(),
        legend.position = c(0.6,0.85),
        legend.title = element_blank(),
        axis.text=element_text(size=10),
        axis.title.y = element_text(margin = margin(r = 22))) +
        scale_y_continuous(limits = c(0, 20)) +
  labs(title = "Taxa de encontro geral por grupo - mamíferos e aves emparelhados - 2014 a 2022", x = " ", y = "Registros/10 km")


G_taxa_encontro_geral_grupo_emparelhado_box_plot

ggsave("graficos/G_taxa_encontro_geral_grupo_emparelhado_box_plot.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

```{r G_taxa_encontro_geral_grupo_emparelhado_media_IC, echo = FALSE}


# Taxa de encontro total por grupos mamíferos e aves emparelhados - média e IC


G_taxa_encontro_geral_grupo_emparelhado_media_IC <- taxa_encontro_periodo_amostragem_classe |> 
 group_by(grupo, classe) |> 
 summarise(
     n = n(),
     taxa_enc_media_grupo = mean(taxa_enc_media),
       dp = sd(taxa_enc_media, na.rm = TRUE),
       ep = dp / sqrt(n),
       IC_95 = qnorm(.975) * ep) |> 

  # View(G_taxa_encontro_geral_bioma_emparelhado_media_IC)

  ggplot(aes(
    x = fct_reorder(grupo, taxa_enc_media_grupo, .desc = F),
    y = taxa_enc_media_grupo)) +
  geom_errorbar(
    aes(ymin = taxa_enc_media_grupo - IC_95, ymax =             taxa_enc_media_grupo + IC_95), 
    position = "dodge2",
    width = 0.1,
    size = 0.6,
    linewidth = 0.3
  ) +
  geom_point(aes(colour = classe, show.legend = FALSE), size = 3, position = position_dodge2(width = 0.1)) +
  scale_color_manual(values = c("#006400", "#BF8120")) +
  theme_minimal() +
  theme(axis.line.x=element_blank(),
        axis.line.y=element_blank(),
        axis.ticks.y = element_blank(),
        axis.ticks.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        #panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank(),
        legend.title = element_blank(),
        legend.position = c(0.10, 0.82),
        axis.text=element_text(size=11),
        axis.title.y = element_text(margin = margin(r = 20))) +
        scale_x_discrete(name = " ") +
        scale_y_continuous(limits = c(0, 15)) +
  labs(title = "Taxa de encontro geral por grupo de UC - mamíferos e aves - 2014 a 2022", x = " ", y = "Registros/10 km")


G_taxa_encontro_geral_grupo_emparelhado_media_IC

ggsave("graficos/G_taxa_encontro_geral_grupo_emparelhado_media_IC.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

# Gráficos da taxa de encontro por classe, por UC e por ano

## Gráfico da taxa de enconro por classe - pareado

```{r grafico taxa de encontro por classe}


# Gráfico da taxa de encontro por classes por ano - mamíferos e aves juntos

# G_taxa_encontro_classe <- taxa_encontro_trilha_classe |>
#   filter(ano == 2022) |>
#   
#   ggplot(aes(
#     x = fct_reorder(uc, taxa_enc_media, .desc = F),
#     y = taxa_enc_media,
#     group = classe,
#     fill = classe
#   )) +
#   geom_col(position = "dodge") +
#   coord_flip() +
#   scale_x_discrete(name = " ") +
#   scale_y_continuous(name = "Registros/10 km") +
#   theme_minimal() +
#   theme(panel.grid.minor.y = element_blank(),
#         panel.grid.major.y = element_blank(),
#         axis.text=element_text(size=7)) +
#   labs(title = "Taxa de encontro de mamíferos e aves por UC - 2022")
# 
# 
# G_taxa_encontro_classe

```

# Gráfico da taxa de encontro de mamíferos por UC por ano

```{r G_taxa_encontro_mamiferos_ucs_ano_barras, echo = FALSE}

G_taxa_encontro_mamiferos_ucs_ano_barras <- taxa_encontro_trilha_classe |>
  filter(ano == 2022 & classe == "Mammalia") |>
  
  ggplot(aes(x = fct_reorder(uc, taxa_enc_media, .desc = F), 
             y = taxa_enc_media)) +
  geom_col(fill = "#008B8B") +
  coord_flip() +
  scale_x_discrete(name = " ") +
  scale_y_continuous(name = "Registros/10 km") +
  theme_minimal() +
  theme(panel.grid.minor.y = element_blank(),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        #panel.grid.major.x = element_blank(),
        axis.text=element_text(size=7)) +
  labs(title = "Taxa de encontro de mamíferos por UC - 2022")


G_taxa_encontro_mamiferos_ucs_ano_barras

ggsave("graficos/G_taxa_encontro_mamiferos_ucs_ano_barras.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

```{r G_taxa_encontro_mamiferos_ucs_ano_media_IC, echo = FALSE}

G_taxa_encontro_mamiferos_ucs_ano_media_IC <- taxa_encontro_trilha_classe |>
  filter(ano == 2022 & classe == "Mammalia") |>
  
  ggplot(aes(
    x = fct_reorder(uc, taxa_enc_media, .desc = F),
    y = taxa_enc_media
  )) +
  geom_point(color = "cyan4", size = 1) +
  geom_errorbar(
    aes(ymin = taxa_enc_media - IC_95, ymax = taxa_enc_media + IC_95),
    #size = 0.8,
    linewidth = 0.5,
    colour = "darkgreen"
  ) +
  coord_flip() +
  scale_x_discrete(name = " ") +
  scale_y_continuous(name = "Registros/10 km") +
  theme_minimal() +
  theme(panel.grid.minor.y = element_blank(),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        #panel.grid.major.x = element_blank(),
        axis.text=element_text(size=7)) +
 labs(title = "Taxa de encontro de mamíferos por UC - 2022")


G_taxa_encontro_mamiferos_ucs_ano_media_IC

ggsave("graficos/G_taxa_encontro_mamiferos_ucs_ano_media_IC.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

```{r G_taxa_encontro_aves_ucs_ano_barras, echo = FALSE}

# Gráfico da taxa de encontro de aves por ano - barras

G_taxa_encontro_aves_ucs_ano_barras <- taxa_encontro_trilha_classe |>
  filter(ano == 2022 & classe == "Aves") |>
  
  ggplot(aes(x = fct_reorder(uc, taxa_enc_media, .desc = F), 
             y = taxa_enc_media)) +
  geom_col(fill = "#008B8B") +
  coord_flip() +
  scale_x_discrete(name = " ") +
  scale_y_continuous(name = "Registros/10 km") +
  theme_minimal() +
  theme(panel.grid.minor.y = element_blank(),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        #panel.grid.major.x = element_blank(),
        axis.text=element_text(size=7)) +
  labs(title = "Taxa de encontro de mamíferos por UC - 2022")

G_taxa_encontro_aves_ucs_ano_barras

ggsave("graficos/G_taxa_encontro_aves_ucs_ano_barras.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

```{r G_taxa_encontro_aves_ucs_ano_media_IC, echo = FALSE}

# Gráfico da taxa de encontro de aves por ano - média e IC

G_taxa_encontro_aves_ucs_ano_media_IC <- taxa_encontro_trilha_classe |>
  filter(ano == 2022 & classe == "Aves") |>
  
  ggplot(aes(
    x = fct_reorder(uc, taxa_enc_media, .desc = F),
    y = taxa_enc_media
  )) +
  geom_point(color = "cyan4", size = 1) +
  geom_errorbar(
    aes(ymin = taxa_enc_media - IC_95, ymax = taxa_enc_media + IC_95),
    #size = 0.8,
    linewidth = 0.5,
    colour = "darkgreen"
  ) +
  coord_flip() +
  scale_x_discrete(name = " ") +
  scale_y_continuous(name = "Registros/10 km") +
  theme_minimal() +
  theme(panel.grid.minor.y = element_blank(),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        #panel.grid.major.x = element_blank(),
        axis.text=element_text(size=7)) +
  labs(title = "Taxa de encontro de aves por UC - 2022")


G_taxa_encontro_aves_ucs_ano_media_IC

ggsave("graficos/G_taxa_encontro_aves_ucs_ano_media_IC.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

```{r cálculos registros por espécie, por trilha, por ano e por UC, include = FALSE}


## Calculando o número de registros por espécie, por trilha, por ano e por UC

registros_taxon_validado <- masto_aves_esforco |> 
  group_by(uc, ano, ea, classe, taxon_validado) |>
  count() |>
  drop_na(taxon_validado)

# View(registros_taxon_validado)


# Juntanto tabelas esforco + registros_taxon_validado

taxa_encontro_trilha_taxon_validado <-
  left_join(registros_taxon_validado,
            esforco_total_trilha,
            c("uc", "ano", "ea"))

#View(taxa_encontro_trilha_taxon_validado)

taxa_encontro_trilha_taxon_validado <-
  taxa_encontro_trilha_taxon_validado |>
  mutate(taxa_encontro = (n / extensao) * 10)

#View(taxa_encontro_trilha_taxon_validado)


# Taxa de encontro de espécies por UC e por ano

taxa_encontro_trilha_taxon_validado_ano <-
  taxa_encontro_trilha_taxon_validado |>
  group_by(uc, ano, classe, taxon_validado) |>
  summarise(
    n = n(),
    taxa_enc_media = mean(taxa_encontro),
    dp = sd(taxa_encontro),
    ep = dp / (sqrt(n)),
    IC_95 = qnorm(.975) * ep)


View(taxa_encontro_trilha_taxon_validado_ano)


# Taxa de encontro de espécies de mamíferos por UC

taxa_encontro_trilha_taxon_validado_mamiferos <-
  taxa_encontro_trilha_taxon_validado |>
  filter(classe == "Mammalia") |> 
  group_by(uc, taxon_validado) |>
  summarise(
    n = n(),
    taxa_enc_media = mean(taxa_encontro),
    dp = sd(taxa_encontro),
    ep = dp / (sqrt(n)),
    IC_95 = qnorm(.975) * ep)

View(taxa_encontro_trilha_taxon_validado_mamiferos)

# Taxa de encontro de espécies de aves por UC

taxa_encontro_trilha_taxon_validado_aves <-
  taxa_encontro_trilha_taxon_validado |>
  filter(classe == "Aves") |> 
  group_by(uc, taxon_validado) |>
  summarise(
    n = n(),
    taxa_enc_media = mean(taxa_encontro),
    dp = sd(taxa_encontro),
    ep = dp / (sqrt(n)),
    IC_95 = qnorm(.975) * ep)

#View(taxa_encontro_trilha_taxon_validado_aves)

```

# Gráficos taxa de encontro de espécies por classe e por UC

## Gráfico da taxa de encontro de espécies de mamíferos por UC

```{r G_taxa_encontro_especies_mamiferos_uc_barras, echo = FALSE}


## Taxa de encontro das espécies de mamíferos por UC


G_taxa_encontro_especies_mamiferos_uc_barras <-
  taxa_encontro_trilha_taxon_validado_mamiferos|>
  filter(uc == "Resex do Cazumbá-Iracema") |>
  
  ggplot(aes(
    x = fct_reorder(taxon_validado, taxa_enc_media, .desc = F),
    y = taxa_enc_media
  )) +
  geom_col(fill = "#008B8B") +
  coord_flip() +
  scale_x_discrete(name = " ") +
  scale_y_continuous(name = "Registros/10 km") +
  theme_minimal() +
  theme(panel.grid.minor.y = element_blank(),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        #panel.grid.major.x = element_blank(),
        axis.text=element_text(size=7)
        ) +
  labs(title = "Taxa de encontro de mamíferos - Resex do Cazumbá-Iracema")  


G_taxa_encontro_especies_mamiferos_uc_barras

ggsave("graficos/G_taxa_encontro_especies_mamiferos_uc_barras.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

```{r  G_taxa_encontro_especies_mamiferos_uc_media_IC, echo = FALSE}


## Taxa de encontro das espécies de mamíferos por UC - média e IC


G_taxa_encontro_especies_mamiferos_uc_media_IC <-
  taxa_encontro_trilha_taxon_validado_mamiferos |>
  filter(uc == "Resex do Cazumbá-Iracema") |>
  
  ggplot(aes(
    x = fct_reorder(taxon_validado, taxa_enc_media, .desc = F),
    y = taxa_enc_media

  )) +
  geom_point(color = "cyan4", size = 1) +
  geom_errorbar(
    aes(ymin = taxa_enc_media - IC_95, ymax = taxa_enc_media + IC_95),
    #size = 0.8,
    linewidth = 0.5,
    colour = "darkgreen"
  ) +
  coord_flip() +
  scale_x_discrete(name = " ") +
  scale_y_continuous(name = "Registros/10 km") +
  theme_minimal() +
  theme(panel.grid.minor.y = element_blank(),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        #panel.grid.major.x = element_blank(),
        axis.text=element_text(size=7)) +
  labs(title = "Taxa de encontro de mamíferos - Resex do Cazumbá-Iracema")  


G_taxa_encontro_especies_mamiferos_uc_media_IC

ggsave("graficos/G_taxa_encontro_especies_mamiferos_uc_media_IC.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

```{r G_taxa_encontro_especies_aves_uc_barras, echo = FALSE}


# Taxa de encontro das espécies de aves por UC - barras


G_taxa_encontro_especies_aves_uc_barras <-
  taxa_encontro_trilha_taxon_validado_aves |>
  filter(uc == "Resex do Cazumbá-Iracema") |>
  
  ggplot(aes(
    x = fct_reorder(taxon_validado, taxa_enc_media, .desc = F),
    y = taxa_enc_media
  )) +
  geom_col(fill = "#008B8B") +
  coord_flip() +
  scale_x_discrete(name = " ") +
  scale_y_continuous(name = "Registros/10 km") +
  theme_minimal() +
  theme(panel.grid.minor.y = element_blank(),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        #panel.grid.major.x = element_blank()
        ) +
  labs(title = "Taxa de encontro de aves - Resex do Cazumbá-Iracema")


G_taxa_encontro_especies_aves_uc_barras

ggsave("graficos/G_taxa_encontro_especies_aves_uc_barras.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

```{r G_taxa_encontro_especies_aves_uc_media_IC, echo = FALSE}


# Taxa de encontro das espécies de aves por UC - média e IC


G_taxa_encontro_especies_aves_uc_media_IC <-
  taxa_encontro_trilha_taxon_validado_aves |>
  filter(uc == "Resex do Cazumbá-Iracema") |>
  
  ggplot(aes(
    x = fct_reorder(taxon_validado, taxa_enc_media, .desc = F),
    y = taxa_enc_media
  )) +
  geom_point(color = "cyan4", size = 2) +
  geom_errorbar(
    aes(ymin = taxa_enc_media - IC_95, ymax = taxa_enc_media + IC_95),
    size = 0.1,
    linewidth = 0.5,
    width = 0.2,
    colour = "darkgreen"
  ) +
  coord_flip() +
  scale_x_discrete(name = " ") +
  scale_y_continuous(name = "Registros/10 km") +
  theme_minimal() +
  theme(panel.grid.minor.y = element_blank(),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        #panel.grid.major.x = element_blank(),
        axis.text=element_text(size=10)) +
  labs(title = "Taxa de encontro de aves - Resex do Cazumbá-Iracema")


G_taxa_encontro_especies_aves_uc_media_IC

ggsave("graficos/G_taxa_encontro_especies_aves_uc_media_IC.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

```{r G_taxa_encontro_especies_mamiferos_uc_ano_barras, echo = FALSE}

## Taxa de encontro das espécies de mamíferos por UC por ano - barras


G_taxa_encontro_especies_mamiferos_uc_ano_barras <-
  taxa_encontro_trilha_taxon_validado_ano|>
  filter(uc == "Resex do Cazumbá-Iracema" & ano == 2022 & classe == "Mammalia") |>
  
  ggplot(aes(
    x = fct_reorder(taxon_validado, taxa_enc_media, .desc = F),
    y = taxa_enc_media
  )) +
  geom_col(fill = "#008B8B") +
  coord_flip() +
  scale_x_discrete(name = " ") +
  scale_y_continuous(name = "Registros/10 km") +
  theme_minimal() +
  theme(panel.grid.minor.y = element_blank(),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        #panel.grid.major.x = element_blank(),
        ) +
  labs(title = "Taxa de encontro de mamíferos por UC - RESEX Cazumbá 2022")


G_taxa_encontro_especies_mamiferos_uc_ano_barras

ggsave("graficos/G_taxa_encontro_especies_mamiferos_uc_ano_barras.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

```{r G_taxa_encontro_especies_mamiferos_uc_ano_media_IC, echo = FALSE}

## Taxa de encontro das espécies de mamíferos por UC por ano - média e IC

G_taxa_encontro_especies_mamiferos_uc_ano_media_IC <-
  taxa_encontro_trilha_taxon_validado_ano|>
  filter(uc == "Resex do Cazumbá-Iracema" & ano == 2022 & classe == "Mammalia") |>
  
  ggplot(aes(
    x = fct_reorder(taxon_validado, taxa_enc_media, .desc = F),
    y = taxa_enc_media
  )) +
  geom_point(color = "cyan4", size = 2) +
  geom_errorbar(
    aes(ymin = taxa_enc_media - IC_95, ymax = taxa_enc_media + IC_95),
    size = 0.1,
    linewidth = 0.025,
    width = 0.2,
    colour = "darkgreen"
  ) +
  coord_flip() +
  scale_x_discrete(name = " ") +
  scale_y_continuous(name = "Registros/10 km") +
  theme_minimal() +
  theme(panel.grid.minor.y = element_blank(),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        #panel.grid.major.x = element_blank(),
        axis.text=element_text(size=10)) +
    labs(title = "Taxa de encontro mamíferos - Resex do Cazumbá-Iracema 2022")


G_taxa_encontro_especies_mamiferos_uc_ano_media_IC

ggsave("graficos/G_taxa_encontro_especies_mamiferos_uc_ano_media_IC.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

```{r G_taxa_encontro_especies_aves_uc_ano_barras, echo = FALSE}

G_taxa_encontro_especies_aves_uc_ano_barras <-
  taxa_encontro_trilha_taxon_validado_ano|>
  filter(uc == "Resex do Cazumbá-Iracema" & ano == 2022 & classe == "Aves") |>
  
  ggplot(aes(
    x = fct_reorder(taxon_validado, taxa_enc_media, .desc = F),
    y = taxa_enc_media
  )) +
  geom_col(fill = "#008B8B") +
  coord_flip() +
  scale_x_discrete(name = " ") +
  scale_y_continuous(name = "Registros/10 km") +
  theme_minimal() +
  theme(panel.grid.minor.y = element_blank(),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        #panel.grid.major.x = element_blank(),
        ) +
  labs(title = "Taxa de encontro aves - Resex do Cazumbá-Iracema 2022")


G_taxa_encontro_especies_aves_uc_ano_barras

ggsave("graficos/G_taxa_encontro_especies_aves_uc_ano_barras.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

```{r G_taxa_encontro_especies_aves_uc_ano_media_IC, echo = FALSE}

G_taxa_encontro_especies_aves_uc_ano_media_IC <-
  taxa_encontro_trilha_taxon_validado_ano|>
  filter(uc == "Resex do Cazumbá-Iracema" & ano == 2022 & classe == "Aves") |>
  
  ggplot(aes(
    x = fct_reorder(taxon_validado, taxa_enc_media, .desc = F),
    y = taxa_enc_media

  )) +
  geom_point(color = "cyan4", size = 2) +
  geom_errorbar(
    aes(ymin = taxa_enc_media - IC_95, ymax = taxa_enc_media + IC_95),
    size = 0.1,
    linewidth = 0.025,
    width = 0.2,
    colour = "darkgreen"
  ) +
  coord_flip() +
  scale_x_discrete(name = " ") +
  scale_y_continuous(limits = c(0, 2.5)) +
  theme_minimal() +
  theme(panel.grid.minor.y = element_blank(),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        #panel.grid.major.x = element_blank(),
        axis.text=element_text(size=10)) +
  labs(title = "Taxa de encontro aves - Resex do Cazumbá-Iracema 2022", y = "Registros/10 km")


G_taxa_encontro_especies_aves_uc_ano_media_IC

ggsave("graficos/G_taxa_encontro_especies_aves_uc_ano_media_IC.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

# Gráficos de espécies

## Gráfico de espécie por UC por ano - RESEX Cazumbá 2022 Callicebus cupreus

```{r G_taxa_encontro_especie_tempo, echo = FALSE}

# Gráfico por espécie por ano por UC - Callicebus cupreus - Resex do Cazumbá-Iracema - usando o erro-padrão

G_taxa_encontro_especie_tempo <- taxa_encontro_trilha_taxon_validado_ano |>
  filter(uc == "Resex do Cazumbá-Iracema" &
           taxon_validado == "Callicebus cupreus") |>
  
  ggplot(aes(
    x = ano,
    y = taxa_enc_media,
    group = taxon_validado,
    col = taxon_validado
  )) +
  geom_errorbar(
    aes(ymin = taxa_enc_media - ep, ymax = taxa_enc_media + ep),
    size = 0.8,
    linewidth = 0.010,
    width = 0.1,
    colour = "darkgreen"
  ) +
  geom_point(color = "cyan4", size = 3) +
  theme_minimal() +
  theme(
    panel.grid.minor.y = element_blank(),
    #panel.grid.major.y = element_blank(),
    panel.grid.minor.x = element_blank(),
    panel.grid.major.x = element_blank(),
    legend.position = "none"
  ) +
  scale_color_viridis(discrete = T) +
  scale_y_continuous(limits = c(0, 3)) +
  labs(title = "Taxa de encontro por ano - Callicebus cupreus - Resex do Cazumbá-Iracema",
       x = " ",
       y = "Registros/10 km",
       col = "Espécie")

G_taxa_encontro_especie_tempo

ggsave("graficos/G_taxa_encontro_especie_tempo.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

## Gráfico da taxa de encontro das espécies de mamíferos por ano por UC

```{r G_taxa_encontro_especies_mamiferos_ano, echo = FALSE}

# Foram representadas apenas espécies com taxa de encontro >= 1

G_taxa_encontro_especies_mamiferos_ano <-
  taxa_encontro_trilha_taxon_validado_ano |>
  filter(uc == "Resex do Cazumbá-Iracema" &
           classe == "Mammalia" &
           taxa_enc_media >= 1) |>

  ggplot(aes(
    x = ano,
    y = taxa_enc_media,
    group = taxon_validado,
    col = taxon_validado
  )) +
  geom_line() +
  geom_point(size = 2) +
  theme_minimal() +
  theme(panel.grid.minor.y = element_blank(),
        #panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank(),
        legend.text=element_text(size=10),
        legend.title = element_blank()) +
        scale_y_continuous(limits = c(0, 2)) +
  labs(title = "Taxa de encontro de mamíferos - Resex do Cazumbá-Iracema",
               x = " ",
               y = "Registros/10 km",
               col = "Espécies")
  

G_taxa_encontro_especies_mamiferos_ano

ggsave("graficos/G_taxa_encontro_especies_mamiferos_ano.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

## Gráfico da taxa de encontro das espécies de aves por ano por UC

```{r G_taxa_encontro_especies_aves_ano, echo = FALSE}

 
G_taxa_encontro_especies_aves_ano <-
  taxa_encontro_trilha_taxon_validado_ano |>
  filter(uc == "Resex do Cazumbá-Iracema" & classe == "Aves") |>

  ggplot(aes(
    x = ano,
    y = taxa_enc_media,
    group = taxon_validado,
    col = taxon_validado
  )) +
  geom_line() +
  geom_point() +
  theme_minimal() +
  theme(panel.grid.minor.y = element_blank(),
        #panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank(),
        legend.title = element_blank()) +
        scale_y_continuous(limits = c(0, 4)) +
  labs(title = "Taxa de encontro de aves por ano - Resex do Cazumbá-Iracema",
               x = " ",
               y = "Registros/10 km",
               col = "Espécies")
  

G_taxa_encontro_especies_aves_ano

ggsave("graficos/G_taxa_encontro_especies_aves_ano.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

## Gráfico da taxa de encontro das espécies de mamíferos por ano por UC

```{r G_taxa_encontro_especies_mamiferos_ano_interativo, echo = FALSE}


G_taxa_encontro_especies_mamiferos_ano_interativo <-
  taxa_encontro_trilha_taxon_validado_ano |>
  filter(uc == "Resex do Cazumbá-Iracema" &
           classe == "Mammalia" &
           taxa_enc_media >= 1) |>

  ggplot(aes(
    x = ano,
    y = taxa_enc_media,
    group = taxon_validado,
    col = taxon_validado
  )) +
  geom_line() +
  geom_point(size = 1.5) +
  theme_minimal() +
  theme(panel.grid.minor.y = element_blank(),
        #panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        legend.title = element_blank(),
        panel.grid.major.x = element_blank()) +
        scale_y_continuous(limits = c(0, 3)) +
  labs(title = "Taxa de encontro de mamíferos por ano - interativo",
               x = " ",
               y = "Registros/10 km",
               col = "Espécies") 
  
ggplotly(G_taxa_encontro_especies_mamiferos_ano_interativo)
 
```

## Gráfico da taxa de encontro das espécies de mamíferos por ano por UC - interativo

```{r G_taxa_encontro_especies_aves_ano_interativo, echo = FALSE}


G_taxa_encontro_especies_aves_ano_interativo <-
  taxa_encontro_trilha_taxon_validado_ano |>
  filter(uc == "Resex do Cazumbá-Iracema" & classe == "Aves") |>

  ggplot(aes(
    x = ano,
    y = taxa_enc_media,
    group = taxon_validado,
    col = taxon_validado
  )) +
  geom_line() +
  geom_point(size = 1.5) +
  theme_minimal() +
  theme(panel.grid.minor.y = element_blank(),
        #panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank(),
        legend.title = element_blank()) +
  labs(title = "Taxa de encontro de aves por ano - interativo",
               x = " ",
               y = "Registros/10 km",
               col = "Espécies") +
  scale_y_continuous(limits = c(0, 4))

ggplotly(G_taxa_encontro_especies_aves_ano_interativo)

```

# Gráficos de espécies ameaçadas

```{r preparando os dados de espécies ameaçadas, include = FALSE}


lista_spp_ameacadas_salve <-
  read_csv("dados_brutos/lista_spp_ameacadas_salve.csv")

#View(lista_spp_ameacadas_salve)

lista_spp_ameacadas_salve <- lista_spp_ameacadas_salve |>
  rename(taxon_validado = nome_cientifico)

taxa_encontro_spp_ameacadas <- left_join(taxa_encontro_trilha_taxon_validado, lista_spp_ameacadas_salve, by = "taxon_validado")

View(taxa_encontro_spp_ameacadas)

taxa_encontro_spp_ameacadas <- taxa_encontro_spp_ameacadas |>
  select(-classe.y) |> 
  rename(classe = classe.x) |> 
  filter(!is.na(categoria))


#View(taxa_encontro_spp_ameacadas)


taxa_encontro_spp_ameacadas_uc <- taxa_encontro_spp_ameacadas |>
  group_by(uc, taxon_validado) |> 
  count()

#View(taxa_encontro_spp_ameacadas_uc)

```

```{r G_especie_ameacada_ucs_box_plot, echo = FALSE}

# Espécie ameaçada por UC

G_especie_ameacada_ucs_box_plot <- taxa_encontro_spp_ameacadas |>
  group_by(uc) |> 
  filter(taxon_validado == "Pauxi tuberosa") |>
  
  ggplot(aes(
    x = uc,
    y = taxa_encontro,
    )) +
  geom_boxplot() +
  coord_flip() +
  theme_minimal() +
  theme(panel.grid.minor.y = element_blank(),
        #panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        #panel.grid.major.x = element_blank(),
        axis.text=element_text(size=8)) +
        #legend.position = "none") +
        #scale_color_viridis(discrete = T)) +
  labs(title = "Taxa de encontro de Pauxi tuberosa por UC",
               x = " ",
               y = "Registros/10 km")

G_especie_ameacada_ucs_box_plot

ggsave("graficos/G_especie_ameacada_ucs_box_plot.png", height = 4.5, width = 6, units = "in", dpi = 300)


```

```{r G_especie_ameacada_ucs_media_IC, echo = FALSE}

G_especie_ameacada_ucs_media_IC <- taxa_encontro_spp_ameacadas |>
  group_by(uc) |> 
  filter(taxon_validado == "Pauxi tuberosa") |>
  summarise(n = n(),
            taxa_enc_media = mean(taxa_encontro),
            sd = sd(taxa_encontro),
            ep = sd / sqrt(n),
            IC_95 = qnorm(.975) * ep) |> 

  ggplot(aes(
    x = uc,
    y = taxa_enc_media,
    )) +
  geom_line(colour = "cyan4") +
  geom_point(color = "cyan4", size = 1.5) +
  geom_errorbar(
    aes(ymin = taxa_enc_media - IC_95, ymax = taxa_enc_media + IC_95),
    size = 0.2,
    linewidth = 0.5,
    width = 0.3,
    colour = "darkgreen"
  ) +
  coord_flip() +
  theme_minimal() +
  theme(
    panel.grid.minor.y = element_blank(),
    panel.grid.major.y = element_blank(),
    panel.grid.minor.x = element_blank(),
    #panel.grid.major.x = element_blank(),
    axis.text=element_text(size=8),
    legend.position = "none") +
    scale_color_viridis(discrete = T) +
    scale_y_continuous(limits = c(0, 2.5)) +
  labs(title = "Taxa de encontro de Pauxi tuberosa por UC",
       x = " ",
       y = "Registros/10 km",
       col = "Espécie")

G_especie_ameacada_ucs_media_IC

ggsave("graficos/G_especie_ameacada_ucs_media_IC.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

```{r G_especie_ameacada_ucs_ano_media_IC, echo = FALSE}

# Espécie ameaçada - Taxa de encontro média por ano - todas as UCs - média e IC

G_especie_ameacada_ucs_ano_media_IC <- taxa_encontro_spp_ameacadas |>
  group_by(ano) |> 
  filter(taxon_validado == "Pauxi tuberosa") |>
  summarise(n = n(),
            taxa_enc_media = mean(taxa_encontro),
            sd = sd(taxa_encontro),
            ep = sd / sqrt(n),
            IC_95 = qnorm(.975) * ep) |>

  ggplot(aes(
    x = ano,
    y = taxa_enc_media,
    )) +
  geom_errorbar(
    aes(ymin = taxa_enc_media - IC_95, ymax = taxa_enc_media + IC_95),
    size = 0.8,
    linewidth = 0.5,
    width = 0.1,
    colour = "darkgreen") +
  geom_point(color = "cyan4", size = 3) +
    theme_minimal() +
    theme(
      panel.grid.minor.y = element_blank(),
      #panel.grid.major.y = element_blank(),
      panel.grid.minor.x = element_blank(),
      panel.grid.major.x = element_blank(),
      axis.text=element_text(size=9),
      legend.position = "none") +
      scale_color_viridis(discrete = T) +
      scale_y_continuous(limits = c(0, 3)) +
  labs(title = "Taxa de encontro média de Pauxi tuberosa - todas as UC",
       x = " ",
       y = "Registros/10 km",
       col = "Espécie")

G_especie_ameacada_ucs_ano_media_IC

ggsave("graficos/G_especie_ameacada_ucs_ano_media_IC.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

```{r G_especie_ameacada_uc_ano_media_IC, echo = FALSE}

G_especie_ameacada_uc_ano_media_IC <- taxa_encontro_spp_ameacadas |>
  filter(uc == "Resex do Cazumbá-Iracema" & taxon_validado == "Penelope jacquacu") |>
  group_by(uc, ano) |> 
  summarise(n = n(),
            taxa_enc_media = mean(taxa_encontro),
            sd = sd(taxa_encontro),
            ep = sd / sqrt(n),
            IC_95 = qnorm(.975) * ep) |>

  ggplot(aes(
    x = ano,
    y = taxa_enc_media)) +
  geom_errorbar(
    aes(ymin = taxa_enc_media - ep, ymax = taxa_enc_media + ep),
    size = 0.8,
    linewidth = 0.5,
    width = 0.1,
    color = "darkgreen"
  ) +
  geom_point(color = "cyan4", size = 3) +
  theme_minimal() +
  theme(
    panel.grid.minor.y = element_blank(),
    #panel.grid.major.y = element_blank(),
    panel.grid.minor.x = element_blank(),
    panel.grid.major.x = element_blank(),
    axis.text=element_text(size=9),
    legend.position = "none"
  ) +
    scale_color_viridis(discrete = T) +
    scale_y_continuous(limits = c(0, 3)) +
  labs(title = "Taxa de encontro de Penelope jacquacu na Resex do Cazumbá-Iracema",
       x = " ",
       y = "Registros/10 km",
       col = "Espécie")

G_especie_ameacada_uc_ano_media_IC

ggsave("graficos/G_especie_ameacada_uc_ano_media_IC.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

# Testes

```{r dados teste, include = FALSE}

library(dados)

# dados_gapminder
#
View(dados_gapminder)
#
# unique(dados_gapminder$pais)
# unique(dados_gapminder$continente)
# unique(dados_gapminder$ano)
#
# names(dados_gapminder)

#### Expectativa de vida média por continente

expectativa_vida_continente <- dados_gapminder |>
  group_by(continente) |>
  summarise(
    n = n(),
    media_exp_vida = mean(expectativa_de_vida),
    sd = sd(expectativa_de_vida),
    ep = sd / (sqrt(n))
  )


#View(expectativa_vida_continente)

### Gráfico A

G_expectativa_vida_continente <- expectativa_vida_continente |>
  
  ggplot(aes(x = continente, y = media_exp_vida)) +
  # geom_line(aes(color = continente)) +
  geom_point(aes(color = continente, size = 3)) +
  geom_errorbar(
    aes(ymin = media_exp_vida - sd, ymax = media_exp_vida + sd),
    size = 0.8,
    width = 0.1
  ) +
  
  #geom_text(aes(label = n), vjust = -3) +
  ylim(0, 80) +
  theme_minimal() +
  theme(
    panel.grid.minor.y = element_blank(),
    #panel.grid.major.y = element_blank(),
    panel.grid.minor.x = element_blank(),
    #panel.grid.major.x = element_blank(),
    legend.position = "none"
  ) +
  #scale_color_viridis(discrete = T) +
  labs(title = "Expectativa de vida por continente",
       x = "Continente",
       y = "Expectativa de vida",
       col = "Continente")

G_expectativa_vida_continente


```

```{r grafico B, include = FALSE}

#### Expectativa de vida média por continente por ano

expectativa_vida_continente_ano <- dados_gapminder |>
  group_by(continente, ano) |>
  summarise(
    n = n(),
    media_exp_vida = mean(expectativa_de_vida),
    sd = sd(expectativa_de_vida),
    ep = sd / (sqrt(n))
  )


#View(expectativa_vida_continente_ano)


### Gráfico B

G_expectativa_vida_continente_ano <-
  expectativa_vida_continente_ano |>
  
  ggplot(aes(x = ano, y = media_exp_vida)) +
  geom_line(aes(color = continente)) +
  geom_point(aes(color = continente)) +
  geom_errorbar(
    aes(ymin = media_exp_vida - ep, ymax = media_exp_vida + ep),
    size = 0.8,
    width = 0.1
  ) +
  
  #geom_text(aes(label = n), vjust = -3) +
  ylim(0, 80) +
  theme_minimal() +
  theme(panel.grid.minor.y = element_blank(),
        #panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank()) +
        #panel.grid.major.x = element_blank(),
        #legend.position = "none") +
        #scale_color_viridis(discrete = T)) +
          labs(title = "Expectativa de vida por continente por ano",
               x = "Ano",
               y = "Expectativa de vida",
               col = "Continente")
        
G_expectativa_vida_continente_ano
        

```

```{r grafico C, include = FALSE}

#### Expectativa de vida média por país África

expectativa_vida_paises_africa <- dados_gapminder |>
  group_by(continente, pais) |>
  filter(continente == "África") |>
  summarise(
    n = n(),
    media_exp_vida = mean(expectativa_de_vida),
    sd = sd(expectativa_de_vida),
    ep = sd / (sqrt(n))
  ) |>
  filter(media_exp_vida > 58)

View(expectativa_vida_paises_africa)


### Gráfico C

G_expectativa_vida_paises_africa <-
  expectativa_vida_paises_africa |>
  
  ggplot(aes(x = pais, y = media_exp_vida)) +
  #geom_line(aes(color = pais)) +
  geom_point(aes(color = pais), size = 3) +
  geom_errorbar(
    aes(ymin = media_exp_vida - sd, ymax = media_exp_vida + sd),
    size = 0.8,
    width = 0.1
  ) +
  
  #geom_text(aes(label = n), vjust = -3) +
  ylim(0, 80) +
  theme_minimal() +
  theme(
    panel.grid.minor.y = element_blank(),
    #panel.grid.major.y = element_blank(),
    panel.grid.minor.x = element_blank(),
    #panel.grid.major.x = element_blank(),
    legend.position = "none"
  ) +
  #scale_color_viridis(discrete = T) +
  labs(title = "Expectativa de vida por país na África",
       x = "País",
       y = "Expectativa de vida",
       col = "País")

G_expectativa_vida_paises_africa



```

```{r grafico D, include = FALSE}

#### PIB per capta em países das Américas

pib_per_capita_americas <- dados_gapminder |>
  group_by(continente, pais) |>
  summarise(
    n = n(),
    media_pib = mean(pib_per_capita),
    sd = sd(pib_per_capita),
    ep = sd / (sqrt(n))
  ) |>
  filter(continente == "Américas")


View(pib_per_capita_americas)


### Gráfico D

G_pib_per_capita_americas <- pib_per_capita_americas |>
  
  ggplot(aes(x = fct_reorder(pais, media_pib, .desc = F), y = media_pib)) +
  geom_col(fill = "#008B8B") +
  coord_flip() +
  scale_x_discrete(name = " ") +
  scale_y_continuous(name = "PIB per capita") +
  
  # ggplot(aes(x = uc, y = taxa_enc_media)) +
  theme_minimal() +
  theme(panel.grid.minor.y = element_blank(),
        panel.grid.major.y = element_blank(),) +
  labs(title = "PIB per capita Américas")

G_pib_per_capita_americas

```
